<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 8.2.0" />
    <title>uuid_module.create_jira_tickets API documentation</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2264%22%20height%3D%2264%22%20viewBox%3D%2244.5%202.5%2015%2015%22%3E%3Cpath%20d%3D%22M49.351%2021.041c-.233-.721-.546-2.408-.772-4.076-.042-.09-.067-.187-.046-.288-.166-1.347-.277-2.625-.241-3.351-1.378-1.008-2.271-2.586-2.271-4.362%200-.976.272-1.935.788-2.774.057-.094.122-.18.184-.268-.033-.167-.052-.339-.052-.516%200-1.477%201.202-2.679%202.679-2.679.791%200%201.496.352%201.987.9a6.3%206.3%200%200%201%201.001.029c.492-.564%201.207-.929%202.012-.929%201.477%200%202.679%201.202%202.679%202.679a2.65%202.65%200%200%201-.269%201.148c.383.747.595%201.572.595%202.41%200%202.311-1.507%204.29-3.635%205.107.037.699.147%202.27.423%203.294l.137.461c.156%202.136-4.612%205.166-5.199%203.215zm.127-4.919a4.78%204.78%200%200%200%20.775-.584c-.172-.115-.505-.254-.88-.378zm.331%202.302l.828-.502c-.202-.143-.576-.328-.984-.49zm.45%202.157l.701-.403c-.214-.115-.536-.249-.891-.376l.19.779zM49.13%204.141c0%20.152.123.276.276.276s.275-.124.275-.276-.123-.276-.276-.276-.275.124-.275.276zm.735-.389a1.15%201.15%200%200%201%20.314.783%201.16%201.16%200%200%201-1.162%201.162c-.457%200-.842-.27-1.032-.653-.026.117-.042.238-.042.362a1.68%201.68%200%200%200%201.679%201.679%201.68%201.68%200%200%200%201.679-1.679c0-.843-.626-1.535-1.436-1.654zm3.076%201.654a1.68%201.68%200%200%200%201.679%201.679%201.68%201.68%200%200%200%201.679-1.679c0-.037-.009-.072-.011-.109-.21.3-.541.508-.935.508a1.16%201.16%200%200%201-1.162-1.162%201.14%201.14%200%200%201%20.474-.912c-.015%200-.03-.005-.045-.005-.926.001-1.679.754-1.679%201.68zm1.861-1.265c0%20.152.123.276.276.276s.275-.124.275-.276-.123-.276-.276-.276-.275.124-.275.276zm1.823%204.823c0-.52-.103-1.035-.288-1.52-.466.394-1.06.64-1.717.64-1.144%200-2.116-.725-2.499-1.738-.383%201.012-1.355%201.738-2.499%201.738-.867%200-1.631-.421-2.121-1.062-.307.605-.478%201.267-.478%201.942%200%202.486%202.153%204.51%204.801%204.51s4.801-2.023%204.801-4.51zm-3.032%209.156l-.146-.492c-.276-1.02-.395-2.457-.444-3.268a6.11%206.11%200%200%201-1.18.115%206.01%206.01%200%200%201-2.536-.562l.006.175c.802.215%201.848.612%202.021%201.25.079.295-.021.601-.274.837l-.598.501c.667.304%201.243.698%201.311%201.179.02.144.022.507-.393.787l-.564.365c1.285.521%201.361.96%201.381%201.126.018.142.011.496-.427.746l-.854.489c.064-1.19%201.985-2.585%202.697-3.248zM49.34%209.925c0-.667%201-.667%201%200%200%20.653.818%201.205%201.787%201.205s1.787-.552%201.787-1.205c0-.667%201-.667%201%200%200%201.216-1.25%202.205-2.787%202.205s-2.787-.989-2.787-2.205zm-.887-7.633c-.093.077-.205.114-.317.114a.5.5%200%200%201-.318-.886L49.183.397a.5.5%200%200%201%20.703.068.5.5%200%200%201-.069.703zm7.661-.065c-.086%200-.173-.022-.253-.068l-1.523-.893c-.575-.337-.069-1.2.506-.863l1.523.892a.5.5%200%200%201%20.179.685c-.094.158-.261.247-.432.247z%22%20fill%3D%22%233bb300%22/%3E%3C/svg%3E"/>


<style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
<style>/*! pygments syntax highlighting */pre{line-height:125%;}td.linenos pre{color:#000000; background-color:#f0f0f0; padding-left:5px; padding-right:5px;}span.linenos{color:#000000; background-color:#f0f0f0; padding-left:5px; padding-right:5px;}td.linenos pre.special{color:#000000; background-color:#ffffc0; padding-left:5px; padding-right:5px;}span.linenos.special{color:#000000; background-color:#ffffc0; padding-left:5px; padding-right:5px;}.pdoc .hll{background-color:#ffffcc}.pdoc{background:#f8f8f8;}.pdoc .c{color:#408080; font-style:italic}.pdoc .err{border:1px solid #FF0000}.pdoc .k{color:#008000; font-weight:bold}.pdoc .o{color:#666666}.pdoc .ch{color:#408080; font-style:italic}.pdoc .cm{color:#408080; font-style:italic}.pdoc .cp{color:#BC7A00}.pdoc .cpf{color:#408080; font-style:italic}.pdoc .c1{color:#408080; font-style:italic}.pdoc .cs{color:#408080; font-style:italic}.pdoc .gd{color:#A00000}.pdoc .ge{font-style:italic}.pdoc .gr{color:#FF0000}.pdoc .gh{color:#000080; font-weight:bold}.pdoc .gi{color:#00A000}.pdoc .go{color:#888888}.pdoc .gp{color:#000080; font-weight:bold}.pdoc .gs{font-weight:bold}.pdoc .gu{color:#800080; font-weight:bold}.pdoc .gt{color:#0044DD}.pdoc .kc{color:#008000; font-weight:bold}.pdoc .kd{color:#008000; font-weight:bold}.pdoc .kn{color:#008000; font-weight:bold}.pdoc .kp{color:#008000}.pdoc .kr{color:#008000; font-weight:bold}.pdoc .kt{color:#B00040}.pdoc .m{color:#666666}.pdoc .s{color:#BA2121}.pdoc .na{color:#7D9029}.pdoc .nb{color:#008000}.pdoc .nc{color:#0000FF; font-weight:bold}.pdoc .no{color:#880000}.pdoc .nd{color:#AA22FF}.pdoc .ni{color:#999999; font-weight:bold}.pdoc .ne{color:#D2413A; font-weight:bold}.pdoc .nf{color:#0000FF}.pdoc .nl{color:#A0A000}.pdoc .nn{color:#0000FF; font-weight:bold}.pdoc .nt{color:#008000; font-weight:bold}.pdoc .nv{color:#19177C}.pdoc .ow{color:#AA22FF; font-weight:bold}.pdoc .w{color:#bbbbbb}.pdoc .mb{color:#666666}.pdoc .mf{color:#666666}.pdoc .mh{color:#666666}.pdoc .mi{color:#666666}.pdoc .mo{color:#666666}.pdoc .sa{color:#BA2121}.pdoc .sb{color:#BA2121}.pdoc .sc{color:#BA2121}.pdoc .dl{color:#BA2121}.pdoc .sd{color:#BA2121; font-style:italic}.pdoc .s2{color:#BA2121}.pdoc .se{color:#BB6622; font-weight:bold}.pdoc .sh{color:#BA2121}.pdoc .si{color:#BB6688; font-weight:bold}.pdoc .sx{color:#008000}.pdoc .sr{color:#BB6688}.pdoc .s1{color:#BA2121}.pdoc .ss{color:#19177C}.pdoc .bp{color:#008000}.pdoc .fm{color:#0000FF}.pdoc .vc{color:#19177C}.pdoc .vg{color:#19177C}.pdoc .vi{color:#19177C}.pdoc .vm{color:#19177C}.pdoc .il{color:#666666}</style>
<style>/*! pdoc */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f7f7f7;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}body{background-color:var(--pdoc-background);}html, body{width:100%;height:100%;}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}.git-button{display:none !important;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}#navtoggle{display:none;}}#togglestate{display:none;}nav.pdoc{--pad:1.75rem;--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent }nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc li{display:block;margin:0;padding:.2rem 0 .2rem var(--indent);transition:all 100ms;}nav.pdoc > div > ul > li{padding-left:0;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}html, main{scroll-behavior:smooth;}.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{background-color:var(--code);border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--code);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.pdoc details{--shift:-40px;text-align:right;margin-top:var(--shift);margin-bottom:calc(0px - var(--shift));clear:both;filter:opacity(1);}.pdoc details:not([open]){height:0;overflow:visible;}.pdoc details > summary{font-size:.75rem;cursor:pointer;color:var(--muted);border-width:0;padding:0 .7em;display:inline-block;display:inline list-item;user-select:none;}.pdoc details > summary:focus{outline:0;}.pdoc details > div{margin-top:calc(0px - var(--shift) / 2);text-align:left;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc > section:first-of-type > .docstring{margin-bottom:3rem;}.pdoc .docstring pre{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc .headerlink{position:absolute;width:0;margin-left:-1.5rem;line-height:1.4rem;font-size:1.5rem;font-weight:normal;transition:all 100ms ease-in-out;opacity:0;}.pdoc .attr > .headerlink{margin-left:-2.5rem;}.pdoc *:hover > .headerlink,.pdoc *:target > .attr > .headerlink{opacity:1;}.pdoc .attr{display:block;color:var(--text);margin:1rem 0 .5rem;padding:.4rem 5rem .4rem 1rem;background-color:var(--accent);}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{white-space:pre-wrap;}.pdoc .annotation{color:var(--annotation);}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
</head>
<body>        <nav class="pdoc">
            <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
            <input id="togglestate" type="checkbox">
            <div>
                        <a class="pdoc-button module-list-button" href="../uuid_module.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                            &nbsp;uuid_module</a>


                        <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                               pattern=".+" required>



                    <h2>API Documentation</h2>
                        <ul class="memberlist">
            <li>
                    <a class="function" href="#build_sub_indexes">build_sub_indexes</a>
            </li>
            <li>
                    <a class="function" href="#form_rows">form_rows</a>
            </li>
            <li>
                    <a class="function" href="#get_push_tickets_sheet">get_push_tickets_sheet</a>
            </li>
            <li>
                    <a class="function" href="#copy_jira_tickets_to_sheets">copy_jira_tickets_to_sheets</a>
            </li>
            <li>
                    <a class="function" href="#copy_errors_to_sheet">copy_errors_to_sheet</a>
            </li>
            <li>
                    <a class="function" href="#copy_uuid_to_index_sheet">copy_uuid_to_index_sheet</a>
            </li>
            <li>
                    <a class="function" href="#build_row_data">build_row_data</a>
            </li>
            <li>
                    <a class="function" href="#create_ticket_index">create_ticket_index</a>
            </li>
            <li>
                    <a class="function" href="#modify_scheduler">modify_scheduler</a>
            </li>
            <li>
                    <a class="function" href="#create_tickets">create_tickets</a>
            </li>
    </ul>



                    <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev">
                        built with <span class="visually-hidden">pdoc</span><img
                            alt="pdoc logo"
                            src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
                    </a>
            </div>
        </nav>
    <main class="pdoc">
            <section>
                    <h1 class="modulename">
<a href="./../uuid_module.html">uuid_module</a><wbr>.create_jira_tickets    </h1>

                
                        <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="kn">import</span> <span class="nn">app.config</span> <span class="k">as</span> <span class="nn">config</span>
<span class="kn">import</span> <span class="nn">smartsheet</span>

<span class="kn">import</span> <span class="nn">uuid_module.helper</span> <span class="k">as</span> <span class="nn">helper</span>
<span class="kn">import</span> <span class="nn">uuid_module.smartsheet_api</span> <span class="k">as</span> <span class="nn">smartsheet_api</span>
<span class="kn">import</span> <span class="nn">uuid_module.variables</span> <span class="k">as</span> <span class="nn">app_vars</span>
<span class="kn">import</span> <span class="nn">uuid_module.get_data</span> <span class="k">as</span> <span class="nn">get_data</span>

<span class="n">project_columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">app_vars</span><span class="o">.</span><span class="n">summary_col</span><span class="p">,</span> <span class="n">app_vars</span><span class="o">.</span><span class="n">task_col</span><span class="p">,</span> <span class="s2">&quot;Issue Type&quot;</span><span class="p">,</span>
                   <span class="n">app_vars</span><span class="o">.</span><span class="n">jira_col</span><span class="p">,</span>
                   <span class="s2">&quot;Parent Ticket&quot;</span><span class="p">,</span> <span class="s2">&quot;Program&quot;</span><span class="p">,</span> <span class="s2">&quot;Initiative&quot;</span><span class="p">,</span> <span class="s2">&quot;Team&quot;</span><span class="p">,</span> <span class="s2">&quot;UUID&quot;</span><span class="p">,</span>
                   <span class="n">app_vars</span><span class="o">.</span><span class="n">predecessor_col</span><span class="p">,</span> <span class="s2">&quot;ParentUUID&quot;</span><span class="p">,</span> <span class="s2">&quot;Project Key&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;Parent Issue Type&quot;</span><span class="p">,</span> <span class="s2">&quot;Inject&quot;</span><span class="p">,</span> <span class="s2">&quot;KTLO&quot;</span><span class="p">]</span>
<span class="n">jira_index_columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">app_vars</span><span class="o">.</span><span class="n">task_col</span><span class="p">,</span> <span class="s2">&quot;Issue Type&quot;</span><span class="p">,</span> <span class="n">app_vars</span><span class="o">.</span><span class="n">jira_col</span><span class="p">,</span>
                      <span class="s2">&quot;Issue Links&quot;</span><span class="p">,</span>
                      <span class="s2">&quot;Project Key&quot;</span><span class="p">,</span> <span class="s2">&quot;Components&quot;</span><span class="p">,</span> <span class="s2">&quot;Labels&quot;</span><span class="p">,</span> <span class="s2">&quot;Epic Link&quot;</span><span class="p">,</span>
                      <span class="s2">&quot;Epic Name&quot;</span><span class="p">,</span> <span class="n">app_vars</span><span class="o">.</span><span class="n">summary_col</span><span class="p">,</span> <span class="s2">&quot;Inject&quot;</span><span class="p">,</span> <span class="s2">&quot;KTLO&quot;</span><span class="p">,</span>
                      <span class="s2">&quot;UUID&quot;</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">build_sub_indexes</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="n">col_map</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Build sub_indexes of UUIDs and Jira Tickets. Evaluates every row.</span>
<span class="sd">       Returns a dict and a list. The dict is all Jira Tickets that have</span>
<span class="sd">       UUIDs associated with them on the sheet. The list is all UUIDs that</span>
<span class="sd">       do not have a Jira Ticket.</span>

<span class="sd">    Args:</span>
<span class="sd">        sheet (smartsheet.models.Sheet): The sheet to build the index from.</span>
<span class="sd">        col_map (dict): The map of column names to column IDs</span>

<span class="sd">    Raises:</span>
<span class="sd">        TypeError: Index sheet must be dict or smartsheet Sheet object</span>
<span class="sd">        TypeError: Index Column Map must be a dict</span>
<span class="sd">        ValueError: Index Sheet should not be empty</span>
<span class="sd">        ValueError: Index Column map should not be empty</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: A subindex of all Jira Tickets: UUIDs</span>
<span class="sd">        list: A subindex of all UUIDs without Jira Tickets</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="n">smartsheet</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Sheet</span><span class="p">)):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Index Sheet should be dict or smartsheet.Sheet, not </span><span class="si">{}</span><span class="s2">&quot;</span>
                  <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">sheet</span><span class="p">))</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">col_map</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Index Column Map should be dict, not </span><span class="si">{}</span><span class="s2">&quot;</span>
                  <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">col_map</span><span class="p">))</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">sheet</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Index Sheet should not be </span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sheet</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">col_map</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Index Col Map should not be </span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sheet</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="c1"># UUID: Jira Ticket</span>
    <span class="n">sub_index_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">sub_index_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">list_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">dict_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">sheet</span><span class="o">.</span><span class="n">rows</span><span class="p">:</span>
        <span class="n">uuid_cell</span> <span class="o">=</span> <span class="n">helper</span><span class="o">.</span><span class="n">get_cell_data</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">app_vars</span><span class="o">.</span><span class="n">uuid_col</span><span class="p">,</span> <span class="n">col_map</span><span class="p">)</span>
        <span class="n">jira_cell</span> <span class="o">=</span> <span class="n">helper</span><span class="o">.</span><span class="n">get_cell_data</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">app_vars</span><span class="o">.</span><span class="n">jira_col</span><span class="p">,</span> <span class="n">col_map</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">uuid_cell</span><span class="p">:</span>
            <span class="c1"># Skip empty UUIDs</span>
            <span class="k">continue</span>

        <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid_cell</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;None&quot;</span><span class="p">:</span>
            <span class="c1"># Skip None values returned as strings</span>
            <span class="k">continue</span>

        <span class="c1"># Check if the UUID string matches our UUID pattern</span>
        <span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\d+-\d+-\d+-\d+&quot;</span><span class="p">,</span> <span class="n">uuid_cell</span><span class="o">.</span><span class="n">value</span><span class="p">)):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Row Number: </span><span class="si">{}</span><span class="s2"> - UUID: </span><span class="si">{}</span><span class="s2"> type: </span><span class="si">{}</span><span class="s2"> - Jira Ticket: </span><span class="si">{}</span><span class="s2"> &quot;</span>
                      <span class="s2">&quot;type: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">row_number</span><span class="p">,</span> <span class="n">uuid_cell</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                                         <span class="nb">type</span><span class="p">(</span><span class="n">uuid_cell</span><span class="o">.</span><span class="n">value</span><span class="p">),</span>
                                         <span class="n">jira_cell</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                                         <span class="nb">type</span><span class="p">(</span><span class="n">jira_cell</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;UUID does not match the pattern. UUID value: </span><span class="si">{}</span><span class="s2">&quot;</span>
                      <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">uuid_cell</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">jira_cell</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">jira_cell</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">list_count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">sub_index_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">uuid_cell</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dict_count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">sub_index_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">uuid_cell</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
            <span class="c1"># Add the UUID (str): Jira Ticket (str)</span>
            <span class="n">sub_index_dict</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">uuid_cell</span><span class="o">.</span><span class="n">value</span><span class="p">)]</span> <span class="o">=</span> <span class="n">jira_cell</span><span class="o">.</span><span class="n">value</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Added </span><span class="si">{}</span><span class="s2"> UUIDS to the sub-index list and </span><span class="si">{}</span><span class="s2"> UUID:Jira pairs &quot;</span>
              <span class="s2">&quot;to the sub-index dict.&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">list_count</span><span class="p">,</span> <span class="n">dict_count</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sub_index_dict</span><span class="p">,</span> <span class="n">sub_index_list</span>


<span class="c1"># TODO: Refactor for the full chain of issue types across multiple Jira</span>
<span class="c1"># projects</span>
<span class="c1"># TODO: Handle creating and linking the Bug issue type</span>
<span class="c1"># TODO: Handle indentation. See API docs</span>
<span class="c1"># https://smartsheet-platform.github.io/api-docs/#specify-row-location</span>
<span class="c1"># specifically parent_id, sibling_id</span>
<span class="k">def</span> <span class="nf">form_rows</span><span class="p">(</span><span class="n">row_dict</span><span class="p">,</span> <span class="n">col_map</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Forms new rows to write to the Jira Push Tickets Sheet</span>

<span class="sd">    Args:</span>
<span class="sd">        row_dict (dict): A dictionary of all rows to parse</span>
<span class="sd">        index_col_map (dict): The column map of the Jira Index Sheet in the</span>
<span class="sd">                              form of Column Name: Column ID</span>

<span class="sd">    Raises:</span>
<span class="sd">        TypeError: Row Dictionary should be a dict</span>
<span class="sd">        TypeError: Index Column Map should be a dict</span>
<span class="sd">        ValueError: Row Dictionary should not be empty</span>
<span class="sd">        ValueError: Index Column Map must not be empty</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: A list of rows and the associated data to upload into</span>
<span class="sd">              Smartsheet.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">row_dict</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Row Dictionary should be type dict, not type </span><span class="si">{}</span><span class="s2">&quot;</span>
                  <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">row_dict</span><span class="p">))</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">col_map</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Index Col Map should be type dict, not type </span><span class="si">{}</span><span class="s2">&quot;</span>
                  <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">col_map</span><span class="p">))</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">row_dict</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Row Dictionary should not be empty&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">col_map</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Index Column Map should not be empty&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="n">rows_to_add</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">row_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">new_row</span> <span class="o">=</span> <span class="n">smartsheet</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Row</span><span class="p">()</span>
        <span class="n">new_row</span><span class="o">.</span><span class="n">to_bottom</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="n">col_name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">col_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">jira_index_columns</span><span class="p">:</span>
                <span class="c1"># Skip writting columns the Index sheet doesn&#39;t have</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">value</span><span class="p">:</span>
                <span class="c1"># Skip null value columns</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">col_name</span> <span class="o">==</span> <span class="n">app_vars</span><span class="o">.</span><span class="n">jira_col</span> <span class="ow">and</span> <span class="n">value</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;Create&quot;</span><span class="p">,</span> <span class="s2">&quot;create&quot;</span><span class="p">):</span>
                <span class="c1"># Skip the Jira Ticket column we&#39;re trying to create</span>
                <span class="c1"># when adding to the Index sheet</span>
                <span class="k">continue</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">col_id</span> <span class="o">=</span> <span class="n">col_map</span><span class="p">[</span><span class="n">col_name</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;KeyError when looking up column name </span><span class="si">{}</span><span class="s2"> in &quot;</span>
                          <span class="s2">&quot;the Jira Index Column Map&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">col_name</span><span class="p">)</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="c1"># Move to next data set, create the row with data that works</span>
                <span class="k">continue</span>
            <span class="n">new_row</span><span class="o">.</span><span class="n">cells</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s1">&#39;column_id&#39;</span><span class="p">:</span> <span class="n">col_id</span><span class="p">,</span>
                <span class="s1">&#39;object_value&#39;</span><span class="p">:</span> <span class="n">value</span>
            <span class="p">})</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;ColName: </span><span class="si">{}</span><span class="s2">, ColID: </span><span class="si">{}</span><span class="s2">, Value: </span><span class="si">{}</span><span class="s2">&quot;</span>
                      <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">col_name</span><span class="p">,</span> <span class="n">col_id</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="c1"># Create labels for program, initiative and team</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Program&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Initiative&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Team&#39;</span><span class="p">]]</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Inject&#39;</span><span class="p">]:</span>
            <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Inject&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;KTLO&#39;</span><span class="p">]:</span>
            <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;KTLO&quot;</span><span class="p">)</span>
        <span class="c1"># Spaces are not supported in Labels. Replace with dashes. For labels</span>
        <span class="c1"># that already have dashes, replace with a single dash rather than the</span>
        <span class="c1"># previous pattern.</span>
        <span class="k">if</span> <span class="n">labels</span><span class="p">:</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">sub</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">sub</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">]</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">sub</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;---&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">sub</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">]</span>
            <span class="n">new_row</span><span class="o">.</span><span class="n">cells</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s1">&#39;column_id&#39;</span><span class="p">:</span> <span class="n">col_map</span><span class="p">[</span><span class="s1">&#39;Labels&#39;</span><span class="p">],</span>
                <span class="s1">&#39;object_value&#39;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s1">&#39;objectType&#39;</span><span class="p">:</span> <span class="s2">&quot;MULTI_PICKLIST&quot;</span><span class="p">,</span>
                    <span class="s1">&#39;values&#39;</span><span class="p">:</span> <span class="n">labels</span>
                <span class="p">}</span>
            <span class="p">})</span>
        <span class="c1"># Add standard components for syncing</span>
        <span class="n">components</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Autogenerated by Smartsheet&quot;</span><span class="p">,</span> <span class="s2">&quot;Sync to Smartsheet&quot;</span><span class="p">]</span>
        <span class="n">new_row</span><span class="o">.</span><span class="n">cells</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s1">&#39;column_id&#39;</span><span class="p">:</span> <span class="n">col_map</span><span class="p">[</span><span class="s1">&#39;Components&#39;</span><span class="p">],</span>
            <span class="s1">&#39;object_value&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;objectType&#39;</span><span class="p">:</span> <span class="s2">&quot;MULTI_PICKLIST&quot;</span><span class="p">,</span>
                <span class="s1">&#39;values&#39;</span><span class="p">:</span> <span class="n">components</span>
            <span class="p">}</span>
        <span class="p">})</span>
        <span class="c1"># If the issue type is an epic, set the Epic Name = Tasks column value</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Issue Type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Epic&quot;</span><span class="p">:</span>
            <span class="n">epic_name</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Tasks&#39;</span><span class="p">]</span>
            <span class="n">new_row</span><span class="o">.</span><span class="n">cells</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s1">&#39;column_id&#39;</span><span class="p">:</span> <span class="n">col_map</span><span class="p">[</span><span class="s1">&#39;Epic Name&#39;</span><span class="p">],</span>
                <span class="s1">&#39;object_value&#39;</span><span class="p">:</span> <span class="n">epic_name</span>
            <span class="p">})</span>

        <span class="c1"># if the issue type is an epic and the parent is a project or epic</span>
        <span class="c1"># use the &#39;implenets&#39; issue link to connect the tickets because epics</span>
        <span class="c1"># can&#39;t use the Epic Link field.</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Issue Type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Epic&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Parent Issue Type&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;Project&quot;</span><span class="p">,</span> <span class="s2">&quot;Epic&quot;</span><span class="p">):</span>
                <span class="n">ticket</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Parent Ticket&#39;</span><span class="p">]</span>
                <span class="n">issue_link</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;implements </span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ticket</span><span class="p">)</span>
                <span class="n">new_row</span><span class="o">.</span><span class="n">cells</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s1">&#39;column_id&#39;</span><span class="p">:</span> <span class="n">col_map</span><span class="p">[</span><span class="s1">&#39;Issue Links&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;object_value&#39;</span><span class="p">:</span> <span class="n">issue_link</span>
                <span class="p">})</span>

        <span class="c1"># If the issue type is a story, task or project, and the parent is</span>
        <span class="c1"># an epic, set the Epic link instead of issue link</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Issue Type&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;Story&quot;</span><span class="p">,</span> <span class="s2">&quot;Task&quot;</span><span class="p">,</span> <span class="s2">&quot;Project&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Parent Issue Type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Epic&quot;</span><span class="p">:</span>
                <span class="n">epic_link</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Parent Ticket&#39;</span><span class="p">]</span>
                <span class="n">new_row</span><span class="o">.</span><span class="n">cells</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s1">&#39;column_id&#39;</span><span class="p">:</span> <span class="n">col_map</span><span class="p">[</span><span class="s1">&#39;Epic Link&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;object_value&#39;</span><span class="p">:</span> <span class="n">epic_link</span>
                <span class="p">})</span>

            <span class="c1"># But if the parent is also a story, task or project, use</span>
            <span class="c1"># Issue links instead</span>
            <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Parent Issue Type&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;Story&quot;</span><span class="p">,</span> <span class="s2">&quot;Task&quot;</span><span class="p">,</span> <span class="s2">&quot;Project&quot;</span><span class="p">):</span>
                <span class="n">ticket</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Parent Ticket&#39;</span><span class="p">]</span>
                <span class="n">issue_link</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;implements </span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ticket</span><span class="p">)</span>
                <span class="n">new_row</span><span class="o">.</span><span class="n">cells</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s1">&#39;column_id&#39;</span><span class="p">:</span> <span class="n">col_map</span><span class="p">[</span><span class="s1">&#39;Issue Links&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;object_value&#39;</span><span class="p">:</span> <span class="n">issue_link</span>
                <span class="p">})</span>

        <span class="n">rows_to_add</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_row</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">rows_to_add</span>


<span class="k">def</span> <span class="nf">get_push_tickets_sheet</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Helper function to get the Push Jira Tickets sheet and build the column</span>
<span class="sd">       map</span>

<span class="sd">    Returns:</span>
<span class="sd">        smartsheet.models.Sheet: The sheet object</span>
<span class="sd">        dict: The column map of Column Names: Column IDs</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">push_ticket_sheet</span> <span class="o">=</span> <span class="n">smartsheet_api</span><span class="o">.</span><span class="n">get_sheet</span><span class="p">(</span>
        <span class="n">config</span><span class="o">.</span><span class="n">push_tickets_sheet</span><span class="p">,</span> <span class="n">config</span><span class="o">.</span><span class="n">minutes</span><span class="p">)</span>
    <span class="n">push_tickets_col_map</span> <span class="o">=</span> <span class="n">helper</span><span class="o">.</span><span class="n">get_column_map</span><span class="p">(</span><span class="n">push_ticket_sheet</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">push_ticket_sheet</span><span class="p">,</span> <span class="n">push_tickets_col_map</span>


<span class="c1"># TODO: Handle the same UUID connected to multiple Jira Tickets.</span>
<span class="k">def</span> <span class="nf">copy_jira_tickets_to_sheets</span><span class="p">(</span><span class="n">source_sheets</span><span class="p">,</span> <span class="n">index_sheet</span><span class="p">,</span> <span class="n">index_col_map</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Uses the UUID column to identify the row that originally pushed data</span>
<span class="sd">       into Jira. Copies the Jira Ticket back into the Program Plan</span>

<span class="sd">    Args:</span>
<span class="sd">        source_sheets (list): A list of Smartsheet Sheet objects push the</span>
<span class="sd">                              Jira Tickets into</span>
<span class="sd">        index_sheet (smartsheet.models.Sheet): The Jira Index Sheet that</span>
<span class="sd">           contains the UUID of the originating row and the Jira Ticket</span>
<span class="sd">           that we want to copy to the source sheet.</span>
<span class="sd">        index_col_map (dict): The column map of Column Names: Column IDs</span>
<span class="sd">           for the Jira Index Sheet</span>

<span class="sd">    Raises:</span>
<span class="sd">        TypeError: Sheet must be a list of sheets</span>
<span class="sd">        TypeError: Index Sheet must be a dict or smartsheet.Sheet object</span>
<span class="sd">        TypeError: Index Column Map must be a dict</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source_sheets</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Sheet should be a list, not </span><span class="si">{}</span><span class="s2">&quot;</span>
                  <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">source_sheets</span><span class="p">))</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index_sheet</span><span class="p">,</span> <span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="n">smartsheet</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Sheet</span><span class="p">)):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Index Sheet should be dict or smartsheet.Sheet, not </span><span class="si">{}</span><span class="s2">&quot;</span>
                  <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">index_sheet</span><span class="p">))</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index_col_map</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Index Column Map should be dict, not </span><span class="si">{}</span><span class="s2">&quot;</span>
                  <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">index_col_map</span><span class="p">))</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">index_col_map</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Index Column Map must not be empty.&quot;</span>
                  <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">()</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_jira_cell</span><span class="p">(</span><span class="n">row_id</span><span class="p">,</span> <span class="n">sheet</span><span class="p">,</span> <span class="n">col_map</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Parse through the sheet&#39;s rows, see if the sheet&#39;s row.id is a</span>
<span class="sd">           match to the given row_id. If there&#39;s a match, get the Jira cell</span>
<span class="sd">           data. Return None if the row ID was not found.</span>

<span class="sd">        Args:</span>
<span class="sd">            row_id (int): The row ID that we want to copy data to</span>
<span class="sd">            sheet (smartsheet.models.Sheet): The sheet that may contain the</span>
<span class="sd">               row_id to copy data to</span>
<span class="sd">            col_map (dict): _description_</span>

<span class="sd">        Returns:</span>
<span class="sd">            smartsheet.models.Cell: A cell object containing the Jira Ticket</span>
<span class="sd">            None: No matching row_id was found in the sheet.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">sheet</span><span class="o">.</span><span class="n">rows</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">row_id</span> <span class="o">==</span> <span class="n">row</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">jira_cell</span> <span class="o">=</span> <span class="n">helper</span><span class="o">.</span><span class="n">get_cell_data</span><span class="p">(</span>
                <span class="n">row</span><span class="p">,</span> <span class="n">app_vars</span><span class="o">.</span><span class="n">jira_col</span><span class="p">,</span> <span class="n">col_map</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">jira_cell</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">contains_uuid</span><span class="p">(</span><span class="n">uuid_list</span><span class="p">,</span> <span class="n">index_dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check to see if the sheet contains any UUIDs from the Jira Index</span>
<span class="sd">           Sheet. Return a subset of matches.</span>

<span class="sd">        Args:</span>
<span class="sd">            uuid_list (list): A list of UUIDs (str) from the source sheet</span>
<span class="sd">            index_dict (dict): A dict of UUIDs (str): Jira Ticket (str) from</span>
<span class="sd">               the Jira Index Sheet</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: A dict of UUIDs: Jira Tickets</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tiny_jira_index</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># For each UUID in the sheet UUID list, check to see if that UUID</span>
        <span class="c1"># is in the index dict keys. If it is not, move on. If it is,</span>
        <span class="c1"># add it to the tiny dict.</span>
        <span class="k">for</span> <span class="n">sheet_uuid</span> <span class="ow">in</span> <span class="n">uuid_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">sheet_uuid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">index_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Create new entry with Sheet UUID, index_dict Jira Ticket</span>
                <span class="n">tiny_jira_index</span><span class="p">[</span><span class="n">sheet_uuid</span><span class="p">]</span> <span class="o">=</span> <span class="n">index_dict</span><span class="p">[</span><span class="n">sheet_uuid</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">tiny_jira_index</span>

    <span class="n">sheets_updated</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># Build an index of UUID (str): Jira Ticket (str) from the Jira Index Sheet</span>
    <span class="c1"># At this point we don&#39;t know if the tickets have been cell linked yet.</span>
    <span class="n">jira_sub_index</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">build_sub_indexes</span><span class="p">(</span><span class="n">index_sheet</span><span class="p">,</span> <span class="n">index_col_map</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">jira_sub_index</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Sub-index of Jira Tickets to link is empty&quot;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sheets_updated</span>

    <span class="c1"># For each Jira Ticket with a UUID in the index sheet, check to see if</span>
    <span class="c1"># that ticket has been linked to the sheet and row in the UUID.</span>
    <span class="k">for</span> <span class="n">sheet</span> <span class="ow">in</span> <span class="n">source_sheets</span><span class="p">:</span>
        <span class="n">sheet_col_map</span> <span class="o">=</span> <span class="n">helper</span><span class="o">.</span><span class="n">get_column_map</span><span class="p">(</span><span class="n">sheet</span><span class="p">)</span>
        <span class="n">rows_to_update</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Validate that the sheet we&#39;re checking has both UUID and Jira</span>
        <span class="c1"># Ticket columns. If they don&#39;t exist, skip the sheet.</span>
        <span class="k">if</span> <span class="n">app_vars</span><span class="o">.</span><span class="n">uuid_col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sheet_col_map</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">app_vars</span><span class="o">.</span><span class="n">jira_col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sheet_col_map</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">continue</span>

        <span class="c1"># Build a list of UUIDs from the sheet.</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">sheet_uuid_list</span> <span class="o">=</span> <span class="n">build_sub_indexes</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="n">sheet_col_map</span><span class="p">)</span>

        <span class="c1"># These are all the UUIDs that had a match in the Jira Index Sheet,</span>
        <span class="c1"># with the associated Jira Ticket from the Index Sheet.</span>
        <span class="n">tiny_index</span> <span class="o">=</span> <span class="n">contains_uuid</span><span class="p">(</span><span class="n">sheet_uuid_list</span><span class="p">,</span> <span class="n">jira_sub_index</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">tiny_index</span><span class="p">:</span>
            <span class="c1"># The index is empty and we didn&#39;t actually match any UUIDs</span>
            <span class="k">continue</span>

        <span class="c1"># Check the sheet and row for each UUID, validate that the ticket is</span>
        <span class="c1"># not already present</span>
        <span class="k">for</span> <span class="n">uuid</span><span class="p">,</span> <span class="n">ticket</span> <span class="ow">in</span> <span class="n">tiny_index</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">split</span> <span class="o">=</span> <span class="n">uuid</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
            <span class="n">row_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">split</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">jira_cell</span> <span class="o">=</span> <span class="n">get_jira_cell</span><span class="p">(</span><span class="n">row_id</span><span class="p">,</span> <span class="n">sheet</span><span class="p">,</span> <span class="n">sheet_col_map</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">jira_cell</span><span class="p">:</span>
                <span class="c1"># Jira column and cell data should exist on this sheet but</span>
                <span class="c1"># don&#39;t for some reason?</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Jira Cell not found on Sheet Name </span><span class="si">{}</span><span class="s2"> | &quot;</span>
                          <span class="s2">&quot;Sheet ID </span><span class="si">{}</span><span class="s2"> | Row ID </span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sheet</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                                                            <span class="n">sheet</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">row_id</span><span class="p">)</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">jira_cell</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">ticket</span><span class="p">:</span>
                <span class="c1"># Jira Ticket has already been copied to the sheet</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">jira_cell</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">jira_cell</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;None&quot;</span><span class="p">:</span>
                <span class="c1"># Jira Ticket cell isn&#39;t &quot;Pending...&quot; so it&#39;s not ready for</span>
                <span class="c1"># a new Jira Ticket. Skip.</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">jira_cell</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;Pending...&quot;</span><span class="p">:</span>
                <span class="c1"># Jira Ticket column for this row is &quot;Pending...&quot;, copy back</span>
                <span class="c1"># the ticket from the Index sheet into the row.</span>
                <span class="n">new_row</span> <span class="o">=</span> <span class="n">smartsheet</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Row</span><span class="p">()</span>
                <span class="n">new_row</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">row_id</span>
                <span class="n">new_row</span><span class="o">.</span><span class="n">cells</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s1">&#39;column_id&#39;</span><span class="p">:</span> <span class="n">sheet_col_map</span><span class="p">[</span><span class="n">app_vars</span><span class="o">.</span><span class="n">jira_col</span><span class="p">],</span>
                    <span class="s1">&#39;object_value&#39;</span><span class="p">:</span> <span class="n">ticket</span>
                <span class="p">})</span>
                <span class="n">rows_to_update</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_row</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">rows_to_update</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Updating Sheet Name: </span><span class="si">{}</span><span class="s2"> | Sheet ID </span><span class="si">{}</span><span class="s2"> with </span><span class="si">{}</span><span class="s2"> rows of &quot;</span>
                      <span class="s2">&quot;newly created Jira Tickets.&quot;</span>
                      <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sheet</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">sheet</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows_to_update</span><span class="p">))</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="n">smartsheet_api</span><span class="o">.</span><span class="n">write_rows_to_sheet</span><span class="p">(</span><span class="n">rows_to_update</span><span class="p">,</span> <span class="n">sheet</span><span class="p">,</span>
                                               <span class="n">write_method</span><span class="o">=</span><span class="s2">&quot;update&quot;</span><span class="p">)</span>
            <span class="n">sheets_updated</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;No new Jira Tickets are ready for copy to &quot;</span>
                      <span class="s2">&quot;Sheet Name: </span><span class="si">{}</span><span class="s2"> | Sheet ID: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sheet</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                                                              <span class="n">sheet</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sheets_updated</span>

<span class="c1"># def link_predecessor_tickets(parent):</span>
<span class="c1">#     Follow predecessor tree, link issues as you go</span>
<span class="c1">#     Roll up the predecessor chain and then</span>
<span class="c1">#     1. Find top level Jira Ticket -&gt; Create if &quot;Create&quot;</span>
<span class="c1">#     2. Find top level Jira Ticket -&gt; If no Jira value, roll</span>
<span class="c1">#        down</span>
<span class="c1">#        the chain until you find &quot;Create&quot; -&gt; Create</span>
<span class="c1">#     3. Find parent Jira ticket, use to create Issue Link</span>
<span class="c1">#     4. Form row, add to list of rows to create and push to Jira</span>
<span class="c1">#        Index</span>
<span class="c1">#     return parent</span>


<span class="k">def</span> <span class="nf">copy_errors_to_sheet</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Copies any sync errors back to the original sheet so that the end user</span>
<span class="sd">       knows if/when/why a ticket creation failed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">push_sheet</span><span class="p">,</span> <span class="n">push_col_map</span> <span class="o">=</span> <span class="n">get_push_tickets_sheet</span><span class="p">()</span>
    <span class="n">success_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">failure_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">skip_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">push_sheet</span><span class="o">.</span><span class="n">rows</span><span class="p">:</span>
        <span class="n">uuid_cell</span> <span class="o">=</span> <span class="n">helper</span><span class="o">.</span><span class="n">get_cell_data</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">app_vars</span><span class="o">.</span><span class="n">uuid_col</span><span class="p">,</span> <span class="n">push_col_map</span><span class="p">)</span>
        <span class="n">sync_cell</span> <span class="o">=</span> <span class="n">helper</span><span class="o">.</span><span class="n">get_cell_data</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="s2">&quot;Sync Status&quot;</span><span class="p">,</span> <span class="n">push_col_map</span><span class="p">)</span>

        <span class="c1"># Skip empty UUID or Sync Error cells or None cell values.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">uuid_cell</span><span class="p">:</span>
            <span class="n">skip_count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">sync_cell</span><span class="p">:</span>
            <span class="n">skip_count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">uuid_cell</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="n">skip_count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">sync_cell</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="n">skip_count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">continue</span>

        <span class="c1"># Get the sheet ID and row ID from the UUID</span>
        <span class="n">split</span> <span class="o">=</span> <span class="n">uuid_cell</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
        <span class="n">sheet_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">split</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">row_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">split</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="c1"># Get the Jira Cell value in the sheet and validate that it should</span>
        <span class="c1"># be written to.</span>
        <span class="n">sheet</span> <span class="o">=</span> <span class="n">smartsheet_api</span><span class="o">.</span><span class="n">get_sheet</span><span class="p">(</span><span class="n">sheet_id</span><span class="p">,</span> <span class="n">config</span><span class="o">.</span><span class="n">minutes</span><span class="p">)</span>
        <span class="n">col_map</span> <span class="o">=</span> <span class="n">helper</span><span class="o">.</span><span class="n">get_column_map</span><span class="p">(</span><span class="n">sheet</span><span class="p">)</span>
        <span class="n">dest_row</span> <span class="o">=</span> <span class="n">smartsheet_api</span><span class="o">.</span><span class="n">get_row</span><span class="p">(</span><span class="n">sheet</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">row_id</span><span class="p">)</span>
        <span class="n">jira_cell</span> <span class="o">=</span> <span class="n">helper</span><span class="o">.</span><span class="n">get_cell_data</span><span class="p">(</span><span class="n">dest_row</span><span class="p">,</span> <span class="n">app_vars</span><span class="o">.</span><span class="n">jira_col</span><span class="p">,</span> <span class="n">col_map</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[a-zA-Z]+-\d+&quot;</span><span class="p">,</span> <span class="n">jira_cell</span><span class="o">.</span><span class="n">value</span><span class="p">)):</span>
            <span class="c1"># Cell value matches the Jira Ticket pattern, skip.</span>
            <span class="n">skip_count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="s2">&quot;reasonPhrase&quot;</span> <span class="ow">in</span> <span class="n">jira_cell</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="c1"># Sync Cell has already been copied.</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;reasonPhrase in Jira Cell, skipping.&quot;</span><span class="p">)</span>
            <span class="n">skip_count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">continue</span>

        <span class="c1"># Write the sync error cell to the row</span>
        <span class="n">new_row</span> <span class="o">=</span> <span class="n">smartsheet</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Row</span><span class="p">()</span>
        <span class="n">new_row</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">row_id</span>
        <span class="n">sync_cell</span><span class="o">.</span><span class="n">column_id</span> <span class="o">=</span> <span class="n">col_map</span><span class="p">[</span><span class="n">app_vars</span><span class="o">.</span><span class="n">jira_col</span><span class="p">]</span>
        <span class="n">sync_cell</span><span class="o">.</span><span class="n">hyperlink</span> <span class="o">=</span> <span class="n">smartsheet</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">ExplicitNull</span><span class="p">()</span>
        <span class="n">new_row</span><span class="o">.</span><span class="n">cells</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sync_cell</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">smartsheet_api</span><span class="o">.</span><span class="n">write_rows_to_sheet</span><span class="p">([</span><span class="n">new_row</span><span class="p">],</span> <span class="n">sheet</span><span class="p">,</span> <span class="s2">&quot;update&quot;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="o">.</span><span class="n">message</span> <span class="o">==</span> <span class="s2">&quot;SUCCESS&quot;</span><span class="p">:</span>
            <span class="n">failure_count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">success_count</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">success_count</span><span class="p">,</span> <span class="n">failure_count</span><span class="p">,</span> <span class="n">skip_count</span>


<span class="k">def</span> <span class="nf">copy_uuid_to_index_sheet</span><span class="p">(</span><span class="n">index_sheet</span><span class="p">,</span> <span class="n">index_col_map</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Copy the UUID from the Push Data Sheet into the Jira Index Sheet after</span>
<span class="sd">       the ticket is created in Jira and synced in to the Index Sheet so that</span>
<span class="sd">       we can push the Jira Ticket back into the Program Plan that triggered</span>
<span class="sd">       the ticket creation.</span>

<span class="sd">    Args:</span>
<span class="sd">        index_sheet (smartsheet.models.Sheet): The Jira Index Sheet</span>
<span class="sd">        index_col_map (dict): The map of Column Names to Column IDs</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if UUIDs were copied, False if they were not.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index_sheet</span><span class="p">,</span> <span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="n">smartsheet</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Sheet</span><span class="p">)):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Index Sheet should be dict or smartsheet.Sheet, not </span><span class="si">{}</span><span class="s2">&quot;</span>
                  <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">index_sheet</span><span class="p">))</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index_col_map</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Index Column Map should be dict, not </span><span class="si">{}</span><span class="s2">&quot;</span>
                  <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">index_col_map</span><span class="p">))</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">index_col_map</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Index Column Map must not be empty.&quot;</span>
                  <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">()</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="n">rows_to_write</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">push_ticket_sheet</span><span class="p">,</span> <span class="n">push_tickets_col_map</span> <span class="o">=</span> <span class="n">get_push_tickets_sheet</span><span class="p">()</span>
    <span class="c1"># Build an index of all rows on the Push Ticket Sheet that have UUIDs</span>
    <span class="c1"># AND Jira tickets</span>
    <span class="n">sub_index</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">build_sub_indexes</span><span class="p">(</span>
        <span class="n">push_ticket_sheet</span><span class="p">,</span> <span class="n">push_tickets_col_map</span><span class="p">)</span>

    <span class="c1"># For each row in the index sheet, get the cell data for the Jira Ticket</span>
    <span class="c1"># cell and the UUID cell.</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">index_sheet</span><span class="o">.</span><span class="n">rows</span><span class="p">:</span>
        <span class="n">jira_ticket</span> <span class="o">=</span> <span class="n">helper</span><span class="o">.</span><span class="n">get_cell_data</span><span class="p">(</span>
            <span class="n">row</span><span class="p">,</span> <span class="n">app_vars</span><span class="o">.</span><span class="n">jira_col</span><span class="p">,</span> <span class="n">index_col_map</span><span class="p">)</span>
        <span class="n">uuid_value</span> <span class="o">=</span> <span class="n">helper</span><span class="o">.</span><span class="n">get_cell_data</span><span class="p">(</span>
            <span class="n">row</span><span class="p">,</span> <span class="n">app_vars</span><span class="o">.</span><span class="n">uuid_col</span><span class="p">,</span> <span class="n">index_col_map</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">uuid_value</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="c1"># Skip rows with UUIDs.</span>
            <span class="k">continue</span>
        <span class="k">for</span> <span class="n">uuid</span><span class="p">,</span> <span class="n">sub_ticket</span> <span class="ow">in</span> <span class="n">sub_index</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">sub_ticket</span> <span class="o">==</span> <span class="n">jira_ticket</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Push ticket </span><span class="si">{}</span><span class="s2"> matches Index ticket </span><span class="si">{}</span><span class="s2">, writing &quot;</span>
                          <span class="s2">&quot;UUID: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sub_ticket</span><span class="p">,</span> <span class="n">jira_ticket</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                                             <span class="n">uuid</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="n">new_row</span> <span class="o">=</span> <span class="n">smartsheet</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Row</span><span class="p">()</span>
                <span class="n">new_row</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">id</span>
                <span class="n">new_row</span><span class="o">.</span><span class="n">cells</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s1">&#39;column_id&#39;</span><span class="p">:</span> <span class="n">index_col_map</span><span class="p">[</span><span class="n">app_vars</span><span class="o">.</span><span class="n">uuid_col</span><span class="p">],</span>
                    <span class="s1">&#39;object_value&#39;</span><span class="p">:</span> <span class="n">uuid</span>
                <span class="p">})</span>
                <span class="n">rows_to_write</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_row</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">rows_to_write</span><span class="p">:</span>
        <span class="n">smartsheet_api</span><span class="o">.</span><span class="n">write_rows_to_sheet</span><span class="p">(</span><span class="n">rows_to_write</span><span class="p">,</span> <span class="n">index_sheet</span><span class="p">,</span>
                                           <span class="n">write_method</span><span class="o">=</span><span class="s2">&quot;update&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;No UUIDs copied to Sheet ID: </span><span class="si">{}</span><span class="s2">, Sheet Name: </span><span class="si">{}</span><span class="s2">&quot;</span>
                  <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index_sheet</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">index_sheet</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>


<span class="k">def</span> <span class="nf">build_row_data</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">col_map</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Builds the row data necessary to create new tickets in Jira. Manually</span>
<span class="sd">       parses a row from a Program Plan and copies select data into the Push</span>
<span class="sd">       Jira Ticket Sheet</span>

<span class="sd">    Args:</span>
<span class="sd">        row (smartsheet.models.Row): The row to parse</span>
<span class="sd">        col_map (dict): The column map of Column Name: Column ID</span>

<span class="sd">    Raises:</span>
<span class="sd">        TypeError: Row must be a dict or smartsheet.models.Row</span>
<span class="sd">        TypeError: Column map must be a dict</span>
<span class="sd">        ValueError: Row must not be empty</span>
<span class="sd">        ValueError: Column map must not be empty</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: A dictionary of the subest of row data to upload to Smartsheet</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="n">smartsheet</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Row</span><span class="p">)):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Sheet should be dict or smartsheet.Sheet, not </span><span class="si">{}</span><span class="s2">&quot;</span>
                  <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">row</span><span class="p">))</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">col_map</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Sheet Column Map should be dict, not </span><span class="si">{}</span><span class="s2">&quot;</span>
                  <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">col_map</span><span class="p">))</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">row</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Row must not be empty.&quot;</span>
                  <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">()</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">col_map</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Column Map must not be empty.&quot;</span>
                  <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">()</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="n">row_data</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">project_columns</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cell</span> <span class="o">=</span> <span class="n">helper</span><span class="o">.</span><span class="n">get_cell_data</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">col_map</span><span class="p">)</span>
            <span class="n">row_data</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">cell</span><span class="o">.</span><span class="n">value</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">continue</span>
    <span class="n">row_data</span><span class="p">[</span><span class="s2">&quot;row_num&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">row_number</span>
    <span class="k">return</span> <span class="n">row_data</span>


<span class="k">def</span> <span class="nf">create_ticket_index</span><span class="p">(</span><span class="n">source_sheets</span><span class="p">,</span> <span class="n">index_sheet</span><span class="p">,</span> <span class="n">index_col_map</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Loads in all sheets recently modified and creates an index of any rows</span>
<span class="sd">       that are ready to create a Jira Ticket or are pending an existing Jira</span>
<span class="sd">       Ticket creation.</span>

<span class="sd">    Args:</span>
<span class="sd">        source_sheets (list): A list of all Smartsheet Sheet objects</span>
<span class="sd">        index_sheet (smartsheet.Sheet): The Jira Index Sheet</span>
<span class="sd">        index_col_map (dict): The Jira Index Sheet column map in the form of</span>
<span class="sd">                              Column Name: Column ID</span>

<span class="sd">    Raises:</span>
<span class="sd">        TypeError: Source Sheets must be a list of sheets</span>
<span class="sd">        TypeError: Index Sheet must be a dict or Smartsheet Sheet object</span>
<span class="sd">        TypeError: Index Column Map must be a dict</span>
<span class="sd">        ValueError: Column map must not be empty</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: A dictionary of all tickets that should be created across all</span>
<span class="sd">              Program Plans</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source_sheets</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Sheet should be dict or smartsheet.Sheet, not </span><span class="si">{}</span><span class="s2">&quot;</span>
                  <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">source_sheets</span><span class="p">))</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index_sheet</span><span class="p">,</span> <span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="n">smartsheet</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Sheet</span><span class="p">)):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Index Sheet should be dict or smartsheet.Sheet, not </span><span class="si">{}</span><span class="s2">&quot;</span>
                  <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">index_sheet</span><span class="p">))</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index_col_map</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Index Column Map should be dict, not </span><span class="si">{}</span><span class="s2">&quot;</span>
                  <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">index_col_map</span><span class="p">))</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">index_col_map</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Column Map must not be empty.&quot;</span>
                  <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">()</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="n">tickets_to_create</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">pending_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">parent_pending_count</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">sheet</span> <span class="ow">in</span> <span class="n">source_sheets</span><span class="p">:</span>
        <span class="n">col_map</span> <span class="o">=</span> <span class="n">helper</span><span class="o">.</span><span class="n">get_column_map</span><span class="p">(</span><span class="n">sheet</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Loaded </span><span class="si">{}</span><span class="s2"> rows from Sheet ID: </span><span class="si">{}</span><span class="s2"> | Sheet Name: </span><span class="si">{}</span><span class="s2">&quot;</span>
                  <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sheet</span><span class="o">.</span><span class="n">rows</span><span class="p">),</span> <span class="n">sheet</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">sheet</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">app_vars</span><span class="o">.</span><span class="n">uuid_col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">col_map</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Sheet ID </span><span class="si">{}</span><span class="s2"> | Sheet Name </span><span class="si">{}</span><span class="s2"> doesn&#39;t have UUID column. &quot;</span>
                      <span class="s2">&quot;Skipping sheet.&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sheet</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">sheet</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="n">sheet_rows_to_update</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">sheet</span><span class="o">.</span><span class="n">rows</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;------------------------&quot;</span><span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;New Row&quot;</span><span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;------------------------&quot;</span><span class="p">)</span>
            <span class="n">row_data</span> <span class="o">=</span> <span class="n">build_row_data</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">col_map</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">row_data</span><span class="p">[</span><span class="n">app_vars</span><span class="o">.</span><span class="n">jira_col</span><span class="p">]:</span>
                <span class="c1"># Skip rows with no data in the Jira column</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Row </span><span class="si">{}</span><span class="s2"> skipped because Jira column was empty.&quot;</span>
                          <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">row_data</span><span class="p">[</span><span class="s2">&quot;row_num&quot;</span><span class="p">])</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">row_data</span><span class="p">[</span><span class="n">app_vars</span><span class="o">.</span><span class="n">summary_col</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;True&quot;</span><span class="p">:</span>
                <span class="c1"># Skip summary rows</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Row </span><span class="si">{}</span><span class="s2"> skipped because Summary column was true.&quot;</span>
                          <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">row_data</span><span class="p">[</span><span class="s2">&quot;row_num&quot;</span><span class="p">])</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">row_data</span><span class="p">[</span><span class="s2">&quot;Team&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># Need team defined (so we can get project key). Skip.</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Row </span><span class="si">{}</span><span class="s2"> skipped because Team column was empty.&quot;</span>
                          <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">row_data</span><span class="p">[</span><span class="s2">&quot;row_num&quot;</span><span class="p">])</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">row_data</span><span class="p">[</span><span class="n">app_vars</span><span class="o">.</span><span class="n">uuid_col</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># No UUID means we can&#39;t push the created ticket IDs back</span>
                <span class="c1"># into the program sheets. Skip.</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Row </span><span class="si">{}</span><span class="s2"> skipped because UUID column was empty.&quot;</span>
                          <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">row_data</span><span class="p">[</span><span class="s2">&quot;row_num&quot;</span><span class="p">])</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">row_data</span><span class="p">[</span><span class="s1">&#39;Issue Type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Sub-Task&quot;</span><span class="p">:</span>
                <span class="c1"># Skip Subtasks, we can&#39;t create them with the connector</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Row </span><span class="si">{}</span><span class="s2"> skipped because Parent Issue Type is </span><span class="si">{}</span><span class="s2">.&quot;</span>
                          <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">row_data</span><span class="p">[</span><span class="s2">&quot;row_num&quot;</span><span class="p">],</span>
                                     <span class="n">row_data</span><span class="p">[</span><span class="s2">&quot;Parent Issue Type&quot;</span><span class="p">])</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">row_data</span><span class="p">[</span><span class="s1">&#39;Parent Issue Type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Sub-Task&quot;</span><span class="p">:</span>
                <span class="c1"># Skip Subtasks, we can&#39;t create them with the connector</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Row </span><span class="si">{}</span><span class="s2"> skipped because Parent Issue Type is </span><span class="si">{}</span><span class="s2">.&quot;</span>
                          <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">row_data</span><span class="p">[</span><span class="s2">&quot;row_num&quot;</span><span class="p">],</span>
                                     <span class="n">row_data</span><span class="p">[</span><span class="s2">&quot;Parent Issue Type&quot;</span><span class="p">])</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[a-zA-Z]+-\d+&quot;</span><span class="p">,</span>
                             <span class="nb">str</span><span class="p">(</span><span class="n">row_data</span><span class="p">[</span><span class="n">app_vars</span><span class="o">.</span><span class="n">jira_col</span><span class="p">]))):</span>
                <span class="c1"># Skip tickets that match the Jira Ticket pattern</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Jira Ticket </span><span class="si">{}</span><span class="s2"> on row </span><span class="si">{}</span><span class="s2"> matches the Jira Ticket&quot;</span>
                          <span class="s2">&quot;pattern&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">row_data</span><span class="p">[</span><span class="n">app_vars</span><span class="o">.</span><span class="n">jira_col</span><span class="p">],</span>
                                            <span class="n">row_data</span><span class="p">[</span><span class="s2">&quot;row_num&quot;</span><span class="p">])</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="s2">&quot;reasonPhrase&quot;</span> <span class="ow">in</span> <span class="n">row_data</span><span class="p">[</span><span class="s2">&quot;Parent Ticket&quot;</span><span class="p">]:</span>
                <span class="c1"># Skip rows where the parent ticket has a sync error</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Parent ticket for row </span><span class="si">{}</span><span class="s2"> has a Jira Sync error: &quot;</span>
                          <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">. Skipping.&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">row_data</span><span class="p">[</span><span class="s2">&quot;row_num&quot;</span><span class="p">],</span>
                                                  <span class="n">row_data</span><span class="p">[</span><span class="n">app_vars</span><span class="o">.</span><span class="n">jira_col</span><span class="p">])</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="s2">&quot;reasonPhrase&quot;</span> <span class="ow">in</span> <span class="n">row_data</span><span class="p">[</span><span class="n">app_vars</span><span class="o">.</span><span class="n">jira_col</span><span class="p">]:</span>
                <span class="c1"># Skip rows where the Jira ticket has a sync error</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Jira ticket for row </span><span class="si">{}</span><span class="s2"> is a Jira Sync error: &quot;</span>
                          <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">. Skipping.&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">row_data</span><span class="p">[</span><span class="s2">&quot;row_num&quot;</span><span class="p">],</span>
                                                  <span class="n">row_data</span><span class="p">[</span><span class="n">app_vars</span><span class="o">.</span><span class="n">jira_col</span><span class="p">])</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">row_data</span><span class="p">[</span><span class="s2">&quot;Parent Ticket&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> \
                    <span class="n">row_data</span><span class="p">[</span><span class="n">app_vars</span><span class="o">.</span><span class="n">jira_col</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;Create&quot;</span><span class="p">,</span> <span class="s2">&quot;create&quot;</span><span class="p">):</span>
                <span class="n">tickets_to_create</span><span class="p">[</span><span class="n">row_data</span><span class="p">[</span><span class="n">app_vars</span><span class="o">.</span><span class="n">uuid_col</span><span class="p">]]</span> <span class="o">=</span> <span class="n">row_data</span>
                <span class="c1"># Set these rows to &quot;Pending...&quot;</span>
                <span class="n">new_row</span> <span class="o">=</span> <span class="n">smartsheet</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Row</span><span class="p">()</span>
                <span class="n">new_row</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">id</span>
                <span class="n">new_row</span><span class="o">.</span><span class="n">cells</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s1">&#39;column_id&#39;</span><span class="p">:</span> <span class="n">col_map</span><span class="p">[</span><span class="n">app_vars</span><span class="o">.</span><span class="n">jira_col</span><span class="p">],</span>
                    <span class="s1">&#39;object_value&#39;</span><span class="p">:</span> <span class="s2">&quot;Pending...&quot;</span>
                <span class="p">})</span>
                <span class="n">sheet_rows_to_update</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_row</span><span class="p">)</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Appended row UUID: </span><span class="si">{}</span><span class="s2"> and associated data to the &quot;</span>
                          <span class="s2">&quot;list of rows to update and set the Jira Ticket &quot;</span>
                          <span class="s2">&quot;column in Sheet Name: </span><span class="si">{}</span><span class="s2"> to Pending...&quot;</span>
                          <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">row_data</span><span class="p">[</span><span class="n">app_vars</span><span class="o">.</span><span class="n">uuid_col</span><span class="p">],</span> <span class="n">sheet</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="c1"># logging.debug(row_data)</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">row_data</span><span class="p">[</span><span class="n">app_vars</span><span class="o">.</span><span class="n">jira_col</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Pending...&quot;</span><span class="p">:</span>
                <span class="c1"># Skip any row that&#39;s already in process</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Skipped because Jira Ticket or Parent Ticket &quot;</span>
                          <span class="s2">&quot;column was set to Pending...&quot;</span><span class="p">)</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="c1"># logging.debug(row_data)</span>
                <span class="n">pending_count</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">row_data</span><span class="p">[</span><span class="s1">&#39;Parent Ticket&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Pending...&quot;</span><span class="p">:</span>
                <span class="c1"># Skip any row that&#39;s already in process</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Skipped because Parent Ticket column was set to &quot;</span>
                          <span class="s2">&quot;Pending...&quot;</span><span class="p">)</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="c1"># logging.debug(row_data)</span>
                <span class="n">parent_pending_count</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">row_data</span><span class="p">[</span><span class="s1">&#39;Parent Ticket&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;Create&#39;</span><span class="p">,</span> <span class="s1">&#39;create&#39;</span><span class="p">,</span>
                                                 <span class="s1">&#39;Pending...&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[a-zA-Z]+-\d+&quot;</span><span class="p">,</span>
                                     <span class="n">row_data</span><span class="p">[</span><span class="s2">&quot;Parent Ticket&quot;</span><span class="p">])):</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Parent Ticket </span><span class="si">{}</span><span class="s2"> on row </span><span class="si">{}</span><span class="s2"> does not match the &quot;</span>
                              <span class="s2">&quot;Jira Ticket pattern. Skipping&quot;</span>
                              <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">row_data</span><span class="p">[</span><span class="n">app_vars</span><span class="o">.</span><span class="n">jira_col</span><span class="p">],</span>
                                         <span class="n">row_data</span><span class="p">[</span><span class="s2">&quot;row_num&quot;</span><span class="p">])</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                    <span class="k">continue</span>

                <span class="k">if</span> <span class="n">row_data</span><span class="p">[</span><span class="n">app_vars</span><span class="o">.</span><span class="n">jira_col</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;Create&#39;</span><span class="p">,</span> <span class="s1">&#39;create&#39;</span><span class="p">):</span>
                    <span class="c1"># Add row data to create tickets.</span>
                    <span class="n">tickets_to_create</span><span class="p">[</span><span class="n">row_data</span><span class="p">[</span><span class="n">app_vars</span><span class="o">.</span><span class="n">uuid_col</span><span class="p">]]</span> <span class="o">=</span> <span class="n">row_data</span>

                    <span class="c1"># Set these rows to &quot;Pending...&quot; in the Plan sheet.</span>
                    <span class="n">new_row</span> <span class="o">=</span> <span class="n">smartsheet</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Row</span><span class="p">()</span>
                    <span class="n">new_row</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">id</span>
                    <span class="n">new_row</span><span class="o">.</span><span class="n">cells</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                        <span class="s1">&#39;column_id&#39;</span><span class="p">:</span> <span class="n">col_map</span><span class="p">[</span><span class="n">app_vars</span><span class="o">.</span><span class="n">jira_col</span><span class="p">],</span>
                        <span class="s1">&#39;object_value&#39;</span><span class="p">:</span> <span class="s2">&quot;Pending...&quot;</span>
                    <span class="p">})</span>
                    <span class="n">sheet_rows_to_update</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_row</span><span class="p">)</span>
                    <span class="n">pending_count</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">continue</span>
            <span class="c1"># TODO: Validate Jira ticket so that comments don&#39;t</span>
            <span class="c1"># cause errors.</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Parent Ticket isn&#39;t &#39;Create&#39; or &#39;Pending...&#39; &quot;</span>
                      <span class="s2">&quot;but it does have a value. Dumping data.&quot;</span><span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">row_data</span><span class="p">)</span>

        <span class="c1"># Validate that there are rows to write.</span>
        <span class="k">if</span> <span class="n">sheet_rows_to_update</span><span class="p">:</span>
            <span class="n">smartsheet_api</span><span class="o">.</span><span class="n">write_rows_to_sheet</span><span class="p">(</span><span class="n">sheet_rows_to_update</span><span class="p">,</span> <span class="n">sheet</span><span class="p">,</span>
                                               <span class="n">write_method</span><span class="o">=</span><span class="s2">&quot;update&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;No rows to update for Sheet ID: </span><span class="si">{}</span><span class="s2">, Sheet Name: </span><span class="si">{}</span><span class="s2">&quot;</span>
                      <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sheet</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">sheet</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Sheet ID: </span><span class="si">{}</span><span class="s2"> | Sheet Name: </span><span class="si">{}</span><span class="s2"> has </span><span class="si">{}</span><span class="s2"> rows pending ticket &quot;</span>
                  <span class="s2">&quot;creation. </span><span class="si">{}</span><span class="s2"> rows are waiting on parent ticket &quot;</span>
                  <span class="s2">&quot;creation.&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sheet</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">sheet</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">pending_count</span><span class="p">,</span>
                                      <span class="n">parent_pending_count</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Top-level Rows to create first&quot;</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;------------------------&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">tickets_to_create</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">tickets_to_create</span>


<span class="k">def</span> <span class="nf">modify_scheduler</span><span class="p">(</span><span class="n">time</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Dynamically modifies the given job depending on how long the last</span>
<span class="sd">       job took to complete.</span>

<span class="sd">    Args:</span>
<span class="sd">        time (int): The amount of time elapsed from the start of the job</span>
<span class="sd">                    to the end of the job (in seconds)</span>

<span class="sd">    Raises:</span>
<span class="sd">        TypeError: Time must be an int or float</span>
<span class="sd">        ValueError: Time must be a positive integer</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: A message about whether the interval was modified or remains</span>
<span class="sd">             the same</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Time must be an int or float, not </span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">time</span><span class="p">))</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">time</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Time must be a positive int or float, not </span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="n">time_in_seconds</span> <span class="o">=</span> <span class="n">time</span>
    <span class="c1"># If time comes in in minutes, make time = 60 seconds</span>
    <span class="k">if</span> <span class="n">time</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">time</span> <span class="o">*</span> <span class="mi">60</span>

    <span class="c1"># Get currently scheduled interval in minutes</span>
    <span class="n">jobs</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">scheduler</span><span class="o">.</span><span class="n">get_job</span><span class="p">(</span><span class="s2">&quot;create_jira_interval&quot;</span><span class="p">)</span>
    <span class="n">jobs</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">jobs</span><span class="p">)</span>
    <span class="n">split</span> <span class="o">=</span> <span class="n">jobs</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
    <span class="n">interval</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">split</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

    <span class="c1"># Round time up to the nearest minute</span>
    <span class="n">time</span> <span class="o">=</span> <span class="n">time</span> <span class="o">//</span> <span class="mi">60</span> <span class="o">+</span> <span class="p">(</span><span class="n">time</span> <span class="o">%</span> <span class="mi">60</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">interval</span> <span class="o">==</span> <span class="n">time</span><span class="p">:</span>
        <span class="c1"># Do nothing. Interval is correctly sized</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Job interval and job runtime are within 1 minute of &quot;</span>
                  <span class="s2">&quot;each other. No changes to interval.&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">interval</span> <span class="o">&gt;</span> <span class="n">time</span><span class="p">:</span>
        <span class="c1"># If the interval is greater than the time it took to run the process,</span>
        <span class="c1"># check to see how much more. If the total time the process took was</span>
        <span class="c1"># over 1 minute less than the interval, reduce the interval by 1</span>
        <span class="c1"># minute.</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="n">interval</span> <span class="o">-</span> <span class="n">time</span>
        <span class="k">if</span> <span class="n">delta</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">new_interval</span> <span class="o">=</span> <span class="n">interval</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">config</span><span class="o">.</span><span class="n">scheduler</span><span class="o">.</span><span class="n">reschedule_job</span><span class="p">(</span><span class="s2">&quot;create_jira_interval&quot;</span><span class="p">,</span>
                                            <span class="n">trigger</span><span class="o">=</span><span class="s2">&quot;interval&quot;</span><span class="p">,</span>
                                            <span class="n">minutes</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">new_interval</span><span class="p">))</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Job interval is </span><span class="si">{}</span><span class="s2"> minute(s) longer than the job &quot;</span>
                      <span class="s2">&quot;runtime. Reduced interval to </span><span class="si">{}</span><span class="s2"> minutes&quot;</span>
                      <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">delta</span><span class="p">),</span> <span class="n">new_interval</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;SUCCESS: Job interval </span><span class="si">{}</span><span class="s2">, elapsed time </span><span class="si">{}</span><span class="s2">, delta </span><span class="si">{}</span><span class="s2">&quot;</span>
                      <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">interval</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">delta</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">interval</span> <span class="o">&lt;</span> <span class="n">time</span><span class="p">:</span>
        <span class="c1"># If the interval is less than the time it took to run the process,</span>
        <span class="c1"># increase the interval. If the delta is less than one minute, add 1</span>
        <span class="c1"># minutes, otherwise add the delta to the interval</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">time_in_seconds</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
            <span class="n">elapsed_warning</span> <span class="o">=</span> <span class="n">helper</span><span class="o">.</span><span class="n">truncate</span><span class="p">(</span><span class="n">time_in_seconds</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">elapsed_warning</span> <span class="o">=</span> <span class="n">time_in_seconds</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Create Jira Tickets took </span><span class="si">{}</span><span class="s2"> seconds longer than &quot;</span>
                  <span class="s2">&quot;the interval&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">elapsed_warning</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="n">time</span> <span class="o">-</span> <span class="n">interval</span>
        <span class="k">if</span> <span class="n">delta</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">new_interval</span> <span class="o">=</span> <span class="n">interval</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">config</span><span class="o">.</span><span class="n">scheduler</span><span class="o">.</span><span class="n">reschedule_job</span><span class="p">(</span><span class="s2">&quot;create_jira_interval&quot;</span><span class="p">,</span>
                                            <span class="n">trigger</span><span class="o">=</span><span class="s2">&quot;interval&quot;</span><span class="p">,</span>
                                            <span class="n">minutes</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">new_interval</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_interval</span> <span class="o">=</span> <span class="n">interval</span> <span class="o">+</span> <span class="n">delta</span>
            <span class="n">config</span><span class="o">.</span><span class="n">scheduler</span><span class="o">.</span><span class="n">reschedule_job</span><span class="p">(</span><span class="s2">&quot;create_jira_interval&quot;</span><span class="p">,</span>
                                            <span class="n">trigger</span><span class="o">=</span><span class="s2">&quot;interval&quot;</span><span class="p">,</span>
                                            <span class="n">minutes</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">new_interval</span><span class="p">))</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;New job interval set to </span><span class="si">{}</span><span class="s2"> minutes&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="nb">int</span><span class="p">(</span><span class="n">new_interval</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;ERROR: Job interval </span><span class="si">{}</span><span class="s2">, elapsed time </span><span class="si">{}</span><span class="s2">&quot;</span>
                  <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">interval</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">msg</span>


<span class="c1"># TODO: Drop parent rows once written to index sheet by removing the &quot;Create&quot;</span>
<span class="c1"># from the Jira Ticket field and/or filtering out UUID matches + nonNull</span>
<span class="c1"># Jira Ticket field on the Index sheet</span>
<span class="k">def</span> <span class="nf">create_tickets</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="n">app_vars</span><span class="o">.</span><span class="n">dev_minutes</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Main function passed to the scheduler to parse and upload data to</span>
<span class="sd">       Smartsheet so that new Jira Tickets can be created. Logs a warning</span>
<span class="sd">       if the process takes longer than the interval.</span>

<span class="sd">    Args:</span>
<span class="sd">        minutes (int, optional): Number of minutes in the past used to filter</span>
<span class="sd">                                 sheets and sheet data. Defaults to</span>
<span class="sd">                                 dev_minutes.</span>

<span class="sd">    Raises:</span>
<span class="sd">        TypeError: Minutes must be an int</span>
<span class="sd">        ValueError: Minutes must be a positive integer or 0</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">minutes</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Minutes should be type: int, not </span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">minutes</span><span class="p">))</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">minutes</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Minutes should be &gt;= 0, not </span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">minutes</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

    <span class="n">sheet_ids</span> <span class="o">=</span> <span class="n">get_data</span><span class="o">.</span><span class="n">get_all_sheet_ids</span><span class="p">(</span><span class="n">minutes</span><span class="p">,</span> <span class="n">config</span><span class="o">.</span><span class="n">workspace_id</span><span class="p">,</span>
                                           <span class="n">config</span><span class="o">.</span><span class="n">index_sheet</span><span class="p">)</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Sheet IDs object type </span><span class="si">{}</span><span class="s2">, object values </span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="nb">type</span><span class="p">(</span><span class="n">sheet_ids</span><span class="p">),</span> <span class="n">sheet_ids</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="n">source_sheets</span> <span class="o">=</span> <span class="n">get_data</span><span class="o">.</span><span class="n">refresh_source_sheets</span><span class="p">(</span><span class="n">sheet_ids</span><span class="p">,</span> <span class="n">minutes</span><span class="p">)</span>

    <span class="c1"># Load the index sheet and create a column map.</span>
    <span class="n">index_sheet</span> <span class="o">=</span> <span class="n">smartsheet_api</span><span class="o">.</span><span class="n">get_sheet</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">index_sheet</span><span class="p">,</span> <span class="n">minutes</span><span class="p">)</span>
    <span class="n">index_col_map</span> <span class="o">=</span> <span class="n">helper</span><span class="o">.</span><span class="n">get_column_map</span><span class="p">(</span><span class="n">index_sheet</span><span class="p">)</span>

    <span class="c1"># Copy UUIDs from Push sheet to Index Sheet</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting to copy UUIDs from the Push Sheet to the &quot;</span>
                 <span class="s2">&quot;Index Sheet.&quot;</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">copy_uuid_to_index_sheet</span><span class="p">(</span><span class="n">index_sheet</span><span class="p">,</span> <span class="n">index_col_map</span><span class="p">)</span>

    <span class="c1"># Refresh the index sheet since we just wrote data</span>
    <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
        <span class="n">index_sheet</span> <span class="o">=</span> <span class="n">smartsheet_api</span><span class="o">.</span><span class="n">get_sheet</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">index_sheet</span><span class="p">,</span>
                                               <span class="n">config</span><span class="o">.</span><span class="n">minutes</span><span class="p">)</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting to push sync error messages to the Program Plans.&quot;</span><span class="p">)</span>
    <span class="n">success_count</span><span class="p">,</span> <span class="n">failure_count</span><span class="p">,</span> <span class="n">skip_count</span> <span class="o">=</span> <span class="n">copy_errors_to_sheet</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">success_count</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Successfully pushed </span><span class="si">{}</span><span class="s2"> sync error messages to &quot;</span>
                  <span class="s2">&quot;their respective source sheets.&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">success_count</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">failure_count</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Failed to push </span><span class="si">{}</span><span class="s2"> sync error messages to &quot;</span>
                  <span class="s2">&quot;their respective source sheets.&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">failure_count</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">skip_count</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> rows skipped.&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">skip_count</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="c1"># Copy Jira Tickets from the index sheet back to the source sheets</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting to copy Jira Tickets from the Index Sheet to the &quot;</span>
                 <span class="s2">&quot;Program Plans.&quot;</span><span class="p">)</span>
    <span class="n">sheets_updated</span> <span class="o">=</span> <span class="n">copy_jira_tickets_to_sheets</span><span class="p">(</span>
        <span class="n">source_sheets</span><span class="p">,</span> <span class="n">index_sheet</span><span class="p">,</span> <span class="n">index_col_map</span><span class="p">)</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Updated </span><span class="si">{}</span><span class="s2"> Plan sheets with newly created Jira tickets.&quot;</span>
              <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sheets_updated</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="c1"># Create an index of rows pending ticket creation.</span>
    <span class="n">tickets_to_create</span> <span class="o">=</span> <span class="n">create_ticket_index</span><span class="p">(</span>
        <span class="n">source_sheets</span><span class="p">,</span> <span class="n">index_sheet</span><span class="p">,</span> <span class="n">index_col_map</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Parent Dict&quot;</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;------------------------&quot;</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">tickets_to_create</span><span class="p">)</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Parent Length: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tickets_to_create</span><span class="p">))</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="c1"># If there are rows that need tickets, write the rows to the Push Ticket</span>
    <span class="c1"># Sheet. Return true once the rows have been written.</span>
    <span class="k">if</span> <span class="n">tickets_to_create</span><span class="p">:</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">push_tickets_col_map</span> <span class="o">=</span> <span class="n">get_push_tickets_sheet</span><span class="p">()</span>
        <span class="n">rows_to_write</span> <span class="o">=</span> <span class="n">form_rows</span><span class="p">(</span><span class="n">tickets_to_create</span><span class="p">,</span> <span class="n">push_tickets_col_map</span><span class="p">)</span>
        <span class="n">smartsheet_api</span><span class="o">.</span><span class="n">write_rows_to_sheet</span><span class="p">(</span><span class="n">rows_to_write</span><span class="p">,</span>
                                           <span class="n">config</span><span class="o">.</span><span class="n">push_tickets_sheet</span><span class="p">)</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">elapsed</span> <span class="o">=</span> <span class="n">end</span> <span class="o">-</span> <span class="n">start</span>
        <span class="n">elapsed</span> <span class="o">=</span> <span class="n">helper</span><span class="o">.</span><span class="n">truncate</span><span class="p">(</span><span class="n">elapsed</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Create new tickets from Program Plan line items &quot;</span>
                     <span class="s2">&quot;took: </span><span class="si">{}</span><span class="s2"> seconds.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">elapsed</span><span class="p">))</span>
        <span class="n">interval_msg</span> <span class="o">=</span> <span class="n">modify_scheduler</span><span class="p">(</span><span class="n">elapsed</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">interval_msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="n">tickets_to_create</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;No parent or child rows remain to be written to the &quot;</span>
                  <span class="s2">&quot;Push Tickets Sheet.&quot;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">elapsed</span> <span class="o">=</span> <span class="n">end</span> <span class="o">-</span> <span class="n">start</span>
        <span class="n">elapsed</span> <span class="o">=</span> <span class="n">helper</span><span class="o">.</span><span class="n">truncate</span><span class="p">(</span><span class="n">elapsed</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Create new tickets from Program Plan line items &quot;</span>
                     <span class="s2">&quot;took: </span><span class="si">{}</span><span class="s2"> seconds.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">elapsed</span><span class="p">))</span>
        <span class="n">interval_msg</span> <span class="o">=</span> <span class="n">modify_scheduler</span><span class="p">(</span><span class="n">elapsed</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">interval_msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">elapsed</span> <span class="o">=</span> <span class="n">end</span> <span class="o">-</span> <span class="n">start</span>
        <span class="n">elapsed</span> <span class="o">=</span> <span class="n">helper</span><span class="o">.</span><span class="n">truncate</span><span class="p">(</span><span class="n">elapsed</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">interval_msg</span> <span class="o">=</span> <span class="n">modify_scheduler</span><span class="p">(</span><span class="n">elapsed</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">interval_msg</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Looping through rows rows to create Jira Tickts &quot;</span>
                  <span class="s2">&quot;failed with an unknown error.&quot;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
</pre></div>

        </details>

            </section>
                <section id="build_sub_indexes">
                            <div class="attr function"><a class="headerlink" href="#build_sub_indexes">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">build_sub_indexes</span><span class="signature">(sheet, col_map)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">build_sub_indexes</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="n">col_map</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Build sub_indexes of UUIDs and Jira Tickets. Evaluates every row.</span>
<span class="sd">       Returns a dict and a list. The dict is all Jira Tickets that have</span>
<span class="sd">       UUIDs associated with them on the sheet. The list is all UUIDs that</span>
<span class="sd">       do not have a Jira Ticket.</span>

<span class="sd">    Args:</span>
<span class="sd">        sheet (smartsheet.models.Sheet): The sheet to build the index from.</span>
<span class="sd">        col_map (dict): The map of column names to column IDs</span>

<span class="sd">    Raises:</span>
<span class="sd">        TypeError: Index sheet must be dict or smartsheet Sheet object</span>
<span class="sd">        TypeError: Index Column Map must be a dict</span>
<span class="sd">        ValueError: Index Sheet should not be empty</span>
<span class="sd">        ValueError: Index Column map should not be empty</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: A subindex of all Jira Tickets: UUIDs</span>
<span class="sd">        list: A subindex of all UUIDs without Jira Tickets</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="n">smartsheet</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Sheet</span><span class="p">)):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Index Sheet should be dict or smartsheet.Sheet, not </span><span class="si">{}</span><span class="s2">&quot;</span>
                  <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">sheet</span><span class="p">))</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">col_map</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Index Column Map should be dict, not </span><span class="si">{}</span><span class="s2">&quot;</span>
                  <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">col_map</span><span class="p">))</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">sheet</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Index Sheet should not be </span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sheet</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">col_map</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Index Col Map should not be </span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sheet</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="c1"># UUID: Jira Ticket</span>
    <span class="n">sub_index_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">sub_index_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">list_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">dict_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">sheet</span><span class="o">.</span><span class="n">rows</span><span class="p">:</span>
        <span class="n">uuid_cell</span> <span class="o">=</span> <span class="n">helper</span><span class="o">.</span><span class="n">get_cell_data</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">app_vars</span><span class="o">.</span><span class="n">uuid_col</span><span class="p">,</span> <span class="n">col_map</span><span class="p">)</span>
        <span class="n">jira_cell</span> <span class="o">=</span> <span class="n">helper</span><span class="o">.</span><span class="n">get_cell_data</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">app_vars</span><span class="o">.</span><span class="n">jira_col</span><span class="p">,</span> <span class="n">col_map</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">uuid_cell</span><span class="p">:</span>
            <span class="c1"># Skip empty UUIDs</span>
            <span class="k">continue</span>

        <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid_cell</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;None&quot;</span><span class="p">:</span>
            <span class="c1"># Skip None values returned as strings</span>
            <span class="k">continue</span>

        <span class="c1"># Check if the UUID string matches our UUID pattern</span>
        <span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\d+-\d+-\d+-\d+&quot;</span><span class="p">,</span> <span class="n">uuid_cell</span><span class="o">.</span><span class="n">value</span><span class="p">)):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Row Number: </span><span class="si">{}</span><span class="s2"> - UUID: </span><span class="si">{}</span><span class="s2"> type: </span><span class="si">{}</span><span class="s2"> - Jira Ticket: </span><span class="si">{}</span><span class="s2"> &quot;</span>
                      <span class="s2">&quot;type: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">row_number</span><span class="p">,</span> <span class="n">uuid_cell</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                                         <span class="nb">type</span><span class="p">(</span><span class="n">uuid_cell</span><span class="o">.</span><span class="n">value</span><span class="p">),</span>
                                         <span class="n">jira_cell</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                                         <span class="nb">type</span><span class="p">(</span><span class="n">jira_cell</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;UUID does not match the pattern. UUID value: </span><span class="si">{}</span><span class="s2">&quot;</span>
                      <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">uuid_cell</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">jira_cell</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">jira_cell</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">list_count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">sub_index_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">uuid_cell</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dict_count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">sub_index_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">uuid_cell</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
            <span class="c1"># Add the UUID (str): Jira Ticket (str)</span>
            <span class="n">sub_index_dict</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">uuid_cell</span><span class="o">.</span><span class="n">value</span><span class="p">)]</span> <span class="o">=</span> <span class="n">jira_cell</span><span class="o">.</span><span class="n">value</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Added </span><span class="si">{}</span><span class="s2"> UUIDS to the sub-index list and </span><span class="si">{}</span><span class="s2"> UUID:Jira pairs &quot;</span>
              <span class="s2">&quot;to the sub-index dict.&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">list_count</span><span class="p">,</span> <span class="n">dict_count</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sub_index_dict</span><span class="p">,</span> <span class="n">sub_index_list</span>
</pre></div>

        </details>

            <div class="docstring"><p>Build sub_indexes of UUIDs and Jira Tickets. Evaluates every row.
   Returns a dict and a list. The dict is all Jira Tickets that have
   UUIDs associated with them on the sheet. The list is all UUIDs that
   do not have a Jira Ticket.</p>

<h6 id="args">Args</h6>

<ul>
<li><strong>sheet (smartsheet.models.Sheet):</strong>  The sheet to build the index from.</li>
<li><strong>col_map (dict):</strong>  The map of column names to column IDs</li>
</ul>

<h6 id="raises">Raises</h6>

<ul>
<li><strong>TypeError:</strong>  Index sheet must be dict or smartsheet Sheet object</li>
<li><strong>TypeError:</strong>  Index Column Map must be a dict</li>
<li><strong>ValueError:</strong>  Index Sheet should not be empty</li>
<li><strong>ValueError:</strong>  Index Column map should not be empty</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>dict: A subindex of all Jira Tickets: UUIDs
  list: A subindex of all UUIDs without Jira Tickets</p>
</blockquote>
</div>


                </section>
                <section id="form_rows">
                            <div class="attr function"><a class="headerlink" href="#form_rows">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">form_rows</span><span class="signature">(row_dict, col_map)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">form_rows</span><span class="p">(</span><span class="n">row_dict</span><span class="p">,</span> <span class="n">col_map</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Forms new rows to write to the Jira Push Tickets Sheet</span>

<span class="sd">    Args:</span>
<span class="sd">        row_dict (dict): A dictionary of all rows to parse</span>
<span class="sd">        index_col_map (dict): The column map of the Jira Index Sheet in the</span>
<span class="sd">                              form of Column Name: Column ID</span>

<span class="sd">    Raises:</span>
<span class="sd">        TypeError: Row Dictionary should be a dict</span>
<span class="sd">        TypeError: Index Column Map should be a dict</span>
<span class="sd">        ValueError: Row Dictionary should not be empty</span>
<span class="sd">        ValueError: Index Column Map must not be empty</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: A list of rows and the associated data to upload into</span>
<span class="sd">              Smartsheet.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">row_dict</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Row Dictionary should be type dict, not type </span><span class="si">{}</span><span class="s2">&quot;</span>
                  <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">row_dict</span><span class="p">))</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">col_map</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Index Col Map should be type dict, not type </span><span class="si">{}</span><span class="s2">&quot;</span>
                  <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">col_map</span><span class="p">))</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">row_dict</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Row Dictionary should not be empty&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">col_map</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Index Column Map should not be empty&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="n">rows_to_add</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">row_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">new_row</span> <span class="o">=</span> <span class="n">smartsheet</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Row</span><span class="p">()</span>
        <span class="n">new_row</span><span class="o">.</span><span class="n">to_bottom</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="n">col_name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">col_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">jira_index_columns</span><span class="p">:</span>
                <span class="c1"># Skip writting columns the Index sheet doesn&#39;t have</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">value</span><span class="p">:</span>
                <span class="c1"># Skip null value columns</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">col_name</span> <span class="o">==</span> <span class="n">app_vars</span><span class="o">.</span><span class="n">jira_col</span> <span class="ow">and</span> <span class="n">value</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;Create&quot;</span><span class="p">,</span> <span class="s2">&quot;create&quot;</span><span class="p">):</span>
                <span class="c1"># Skip the Jira Ticket column we&#39;re trying to create</span>
                <span class="c1"># when adding to the Index sheet</span>
                <span class="k">continue</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">col_id</span> <span class="o">=</span> <span class="n">col_map</span><span class="p">[</span><span class="n">col_name</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;KeyError when looking up column name </span><span class="si">{}</span><span class="s2"> in &quot;</span>
                          <span class="s2">&quot;the Jira Index Column Map&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">col_name</span><span class="p">)</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="c1"># Move to next data set, create the row with data that works</span>
                <span class="k">continue</span>
            <span class="n">new_row</span><span class="o">.</span><span class="n">cells</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s1">&#39;column_id&#39;</span><span class="p">:</span> <span class="n">col_id</span><span class="p">,</span>
                <span class="s1">&#39;object_value&#39;</span><span class="p">:</span> <span class="n">value</span>
            <span class="p">})</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;ColName: </span><span class="si">{}</span><span class="s2">, ColID: </span><span class="si">{}</span><span class="s2">, Value: </span><span class="si">{}</span><span class="s2">&quot;</span>
                      <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">col_name</span><span class="p">,</span> <span class="n">col_id</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="c1"># Create labels for program, initiative and team</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Program&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Initiative&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Team&#39;</span><span class="p">]]</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Inject&#39;</span><span class="p">]:</span>
            <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Inject&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;KTLO&#39;</span><span class="p">]:</span>
            <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;KTLO&quot;</span><span class="p">)</span>
        <span class="c1"># Spaces are not supported in Labels. Replace with dashes. For labels</span>
        <span class="c1"># that already have dashes, replace with a single dash rather than the</span>
        <span class="c1"># previous pattern.</span>
        <span class="k">if</span> <span class="n">labels</span><span class="p">:</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">sub</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">sub</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">]</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">sub</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;---&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">sub</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">]</span>
            <span class="n">new_row</span><span class="o">.</span><span class="n">cells</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s1">&#39;column_id&#39;</span><span class="p">:</span> <span class="n">col_map</span><span class="p">[</span><span class="s1">&#39;Labels&#39;</span><span class="p">],</span>
                <span class="s1">&#39;object_value&#39;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s1">&#39;objectType&#39;</span><span class="p">:</span> <span class="s2">&quot;MULTI_PICKLIST&quot;</span><span class="p">,</span>
                    <span class="s1">&#39;values&#39;</span><span class="p">:</span> <span class="n">labels</span>
                <span class="p">}</span>
            <span class="p">})</span>
        <span class="c1"># Add standard components for syncing</span>
        <span class="n">components</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Autogenerated by Smartsheet&quot;</span><span class="p">,</span> <span class="s2">&quot;Sync to Smartsheet&quot;</span><span class="p">]</span>
        <span class="n">new_row</span><span class="o">.</span><span class="n">cells</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s1">&#39;column_id&#39;</span><span class="p">:</span> <span class="n">col_map</span><span class="p">[</span><span class="s1">&#39;Components&#39;</span><span class="p">],</span>
            <span class="s1">&#39;object_value&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;objectType&#39;</span><span class="p">:</span> <span class="s2">&quot;MULTI_PICKLIST&quot;</span><span class="p">,</span>
                <span class="s1">&#39;values&#39;</span><span class="p">:</span> <span class="n">components</span>
            <span class="p">}</span>
        <span class="p">})</span>
        <span class="c1"># If the issue type is an epic, set the Epic Name = Tasks column value</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Issue Type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Epic&quot;</span><span class="p">:</span>
            <span class="n">epic_name</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Tasks&#39;</span><span class="p">]</span>
            <span class="n">new_row</span><span class="o">.</span><span class="n">cells</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s1">&#39;column_id&#39;</span><span class="p">:</span> <span class="n">col_map</span><span class="p">[</span><span class="s1">&#39;Epic Name&#39;</span><span class="p">],</span>
                <span class="s1">&#39;object_value&#39;</span><span class="p">:</span> <span class="n">epic_name</span>
            <span class="p">})</span>

        <span class="c1"># if the issue type is an epic and the parent is a project or epic</span>
        <span class="c1"># use the &#39;implenets&#39; issue link to connect the tickets because epics</span>
        <span class="c1"># can&#39;t use the Epic Link field.</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Issue Type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Epic&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Parent Issue Type&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;Project&quot;</span><span class="p">,</span> <span class="s2">&quot;Epic&quot;</span><span class="p">):</span>
                <span class="n">ticket</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Parent Ticket&#39;</span><span class="p">]</span>
                <span class="n">issue_link</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;implements </span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ticket</span><span class="p">)</span>
                <span class="n">new_row</span><span class="o">.</span><span class="n">cells</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s1">&#39;column_id&#39;</span><span class="p">:</span> <span class="n">col_map</span><span class="p">[</span><span class="s1">&#39;Issue Links&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;object_value&#39;</span><span class="p">:</span> <span class="n">issue_link</span>
                <span class="p">})</span>

        <span class="c1"># If the issue type is a story, task or project, and the parent is</span>
        <span class="c1"># an epic, set the Epic link instead of issue link</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Issue Type&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;Story&quot;</span><span class="p">,</span> <span class="s2">&quot;Task&quot;</span><span class="p">,</span> <span class="s2">&quot;Project&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Parent Issue Type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Epic&quot;</span><span class="p">:</span>
                <span class="n">epic_link</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Parent Ticket&#39;</span><span class="p">]</span>
                <span class="n">new_row</span><span class="o">.</span><span class="n">cells</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s1">&#39;column_id&#39;</span><span class="p">:</span> <span class="n">col_map</span><span class="p">[</span><span class="s1">&#39;Epic Link&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;object_value&#39;</span><span class="p">:</span> <span class="n">epic_link</span>
                <span class="p">})</span>

            <span class="c1"># But if the parent is also a story, task or project, use</span>
            <span class="c1"># Issue links instead</span>
            <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Parent Issue Type&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;Story&quot;</span><span class="p">,</span> <span class="s2">&quot;Task&quot;</span><span class="p">,</span> <span class="s2">&quot;Project&quot;</span><span class="p">):</span>
                <span class="n">ticket</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Parent Ticket&#39;</span><span class="p">]</span>
                <span class="n">issue_link</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;implements </span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ticket</span><span class="p">)</span>
                <span class="n">new_row</span><span class="o">.</span><span class="n">cells</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s1">&#39;column_id&#39;</span><span class="p">:</span> <span class="n">col_map</span><span class="p">[</span><span class="s1">&#39;Issue Links&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;object_value&#39;</span><span class="p">:</span> <span class="n">issue_link</span>
                <span class="p">})</span>

        <span class="n">rows_to_add</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_row</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">rows_to_add</span>
</pre></div>

        </details>

            <div class="docstring"><p>Forms new rows to write to the Jira Push Tickets Sheet</p>

<h6 id="args">Args</h6>

<ul>
<li><strong>row_dict (dict):</strong>  A dictionary of all rows to parse</li>
<li><strong>index_col_map (dict):</strong>  The column map of the Jira Index Sheet in the
form of Column Name: Column ID</li>
</ul>

<h6 id="raises">Raises</h6>

<ul>
<li><strong>TypeError:</strong>  Row Dictionary should be a dict</li>
<li><strong>TypeError:</strong>  Index Column Map should be a dict</li>
<li><strong>ValueError:</strong>  Row Dictionary should not be empty</li>
<li><strong>ValueError:</strong>  Index Column Map must not be empty</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>list: A list of rows and the associated data to upload into
        Smartsheet.</p>
</blockquote>
</div>


                </section>
                <section id="get_push_tickets_sheet">
                            <div class="attr function"><a class="headerlink" href="#get_push_tickets_sheet">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">get_push_tickets_sheet</span><span class="signature">()</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_push_tickets_sheet</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Helper function to get the Push Jira Tickets sheet and build the column</span>
<span class="sd">       map</span>

<span class="sd">    Returns:</span>
<span class="sd">        smartsheet.models.Sheet: The sheet object</span>
<span class="sd">        dict: The column map of Column Names: Column IDs</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">push_ticket_sheet</span> <span class="o">=</span> <span class="n">smartsheet_api</span><span class="o">.</span><span class="n">get_sheet</span><span class="p">(</span>
        <span class="n">config</span><span class="o">.</span><span class="n">push_tickets_sheet</span><span class="p">,</span> <span class="n">config</span><span class="o">.</span><span class="n">minutes</span><span class="p">)</span>
    <span class="n">push_tickets_col_map</span> <span class="o">=</span> <span class="n">helper</span><span class="o">.</span><span class="n">get_column_map</span><span class="p">(</span><span class="n">push_ticket_sheet</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">push_ticket_sheet</span><span class="p">,</span> <span class="n">push_tickets_col_map</span>
</pre></div>

        </details>

            <div class="docstring"><p>Helper function to get the Push Jira Tickets sheet and build the column
   map</p>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>smartsheet.models.Sheet: The sheet object
  dict: The column map of Column Names: Column IDs</p>
</blockquote>
</div>


                </section>
                <section id="copy_jira_tickets_to_sheets">
                            <div class="attr function"><a class="headerlink" href="#copy_jira_tickets_to_sheets">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">copy_jira_tickets_to_sheets</span><span class="signature">(source_sheets, index_sheet, index_col_map)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">copy_jira_tickets_to_sheets</span><span class="p">(</span><span class="n">source_sheets</span><span class="p">,</span> <span class="n">index_sheet</span><span class="p">,</span> <span class="n">index_col_map</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Uses the UUID column to identify the row that originally pushed data</span>
<span class="sd">       into Jira. Copies the Jira Ticket back into the Program Plan</span>

<span class="sd">    Args:</span>
<span class="sd">        source_sheets (list): A list of Smartsheet Sheet objects push the</span>
<span class="sd">                              Jira Tickets into</span>
<span class="sd">        index_sheet (smartsheet.models.Sheet): The Jira Index Sheet that</span>
<span class="sd">           contains the UUID of the originating row and the Jira Ticket</span>
<span class="sd">           that we want to copy to the source sheet.</span>
<span class="sd">        index_col_map (dict): The column map of Column Names: Column IDs</span>
<span class="sd">           for the Jira Index Sheet</span>

<span class="sd">    Raises:</span>
<span class="sd">        TypeError: Sheet must be a list of sheets</span>
<span class="sd">        TypeError: Index Sheet must be a dict or smartsheet.Sheet object</span>
<span class="sd">        TypeError: Index Column Map must be a dict</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source_sheets</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Sheet should be a list, not </span><span class="si">{}</span><span class="s2">&quot;</span>
                  <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">source_sheets</span><span class="p">))</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index_sheet</span><span class="p">,</span> <span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="n">smartsheet</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Sheet</span><span class="p">)):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Index Sheet should be dict or smartsheet.Sheet, not </span><span class="si">{}</span><span class="s2">&quot;</span>
                  <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">index_sheet</span><span class="p">))</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index_col_map</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Index Column Map should be dict, not </span><span class="si">{}</span><span class="s2">&quot;</span>
                  <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">index_col_map</span><span class="p">))</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">index_col_map</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Index Column Map must not be empty.&quot;</span>
                  <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">()</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_jira_cell</span><span class="p">(</span><span class="n">row_id</span><span class="p">,</span> <span class="n">sheet</span><span class="p">,</span> <span class="n">col_map</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Parse through the sheet&#39;s rows, see if the sheet&#39;s row.id is a</span>
<span class="sd">           match to the given row_id. If there&#39;s a match, get the Jira cell</span>
<span class="sd">           data. Return None if the row ID was not found.</span>

<span class="sd">        Args:</span>
<span class="sd">            row_id (int): The row ID that we want to copy data to</span>
<span class="sd">            sheet (smartsheet.models.Sheet): The sheet that may contain the</span>
<span class="sd">               row_id to copy data to</span>
<span class="sd">            col_map (dict): _description_</span>

<span class="sd">        Returns:</span>
<span class="sd">            smartsheet.models.Cell: A cell object containing the Jira Ticket</span>
<span class="sd">            None: No matching row_id was found in the sheet.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">sheet</span><span class="o">.</span><span class="n">rows</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">row_id</span> <span class="o">==</span> <span class="n">row</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">jira_cell</span> <span class="o">=</span> <span class="n">helper</span><span class="o">.</span><span class="n">get_cell_data</span><span class="p">(</span>
                <span class="n">row</span><span class="p">,</span> <span class="n">app_vars</span><span class="o">.</span><span class="n">jira_col</span><span class="p">,</span> <span class="n">col_map</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">jira_cell</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">contains_uuid</span><span class="p">(</span><span class="n">uuid_list</span><span class="p">,</span> <span class="n">index_dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check to see if the sheet contains any UUIDs from the Jira Index</span>
<span class="sd">           Sheet. Return a subset of matches.</span>

<span class="sd">        Args:</span>
<span class="sd">            uuid_list (list): A list of UUIDs (str) from the source sheet</span>
<span class="sd">            index_dict (dict): A dict of UUIDs (str): Jira Ticket (str) from</span>
<span class="sd">               the Jira Index Sheet</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: A dict of UUIDs: Jira Tickets</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tiny_jira_index</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># For each UUID in the sheet UUID list, check to see if that UUID</span>
        <span class="c1"># is in the index dict keys. If it is not, move on. If it is,</span>
        <span class="c1"># add it to the tiny dict.</span>
        <span class="k">for</span> <span class="n">sheet_uuid</span> <span class="ow">in</span> <span class="n">uuid_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">sheet_uuid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">index_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Create new entry with Sheet UUID, index_dict Jira Ticket</span>
                <span class="n">tiny_jira_index</span><span class="p">[</span><span class="n">sheet_uuid</span><span class="p">]</span> <span class="o">=</span> <span class="n">index_dict</span><span class="p">[</span><span class="n">sheet_uuid</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">tiny_jira_index</span>

    <span class="n">sheets_updated</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># Build an index of UUID (str): Jira Ticket (str) from the Jira Index Sheet</span>
    <span class="c1"># At this point we don&#39;t know if the tickets have been cell linked yet.</span>
    <span class="n">jira_sub_index</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">build_sub_indexes</span><span class="p">(</span><span class="n">index_sheet</span><span class="p">,</span> <span class="n">index_col_map</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">jira_sub_index</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Sub-index of Jira Tickets to link is empty&quot;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sheets_updated</span>

    <span class="c1"># For each Jira Ticket with a UUID in the index sheet, check to see if</span>
    <span class="c1"># that ticket has been linked to the sheet and row in the UUID.</span>
    <span class="k">for</span> <span class="n">sheet</span> <span class="ow">in</span> <span class="n">source_sheets</span><span class="p">:</span>
        <span class="n">sheet_col_map</span> <span class="o">=</span> <span class="n">helper</span><span class="o">.</span><span class="n">get_column_map</span><span class="p">(</span><span class="n">sheet</span><span class="p">)</span>
        <span class="n">rows_to_update</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Validate that the sheet we&#39;re checking has both UUID and Jira</span>
        <span class="c1"># Ticket columns. If they don&#39;t exist, skip the sheet.</span>
        <span class="k">if</span> <span class="n">app_vars</span><span class="o">.</span><span class="n">uuid_col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sheet_col_map</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">app_vars</span><span class="o">.</span><span class="n">jira_col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sheet_col_map</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">continue</span>

        <span class="c1"># Build a list of UUIDs from the sheet.</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">sheet_uuid_list</span> <span class="o">=</span> <span class="n">build_sub_indexes</span><span class="p">(</span><span class="n">sheet</span><span class="p">,</span> <span class="n">sheet_col_map</span><span class="p">)</span>

        <span class="c1"># These are all the UUIDs that had a match in the Jira Index Sheet,</span>
        <span class="c1"># with the associated Jira Ticket from the Index Sheet.</span>
        <span class="n">tiny_index</span> <span class="o">=</span> <span class="n">contains_uuid</span><span class="p">(</span><span class="n">sheet_uuid_list</span><span class="p">,</span> <span class="n">jira_sub_index</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">tiny_index</span><span class="p">:</span>
            <span class="c1"># The index is empty and we didn&#39;t actually match any UUIDs</span>
            <span class="k">continue</span>

        <span class="c1"># Check the sheet and row for each UUID, validate that the ticket is</span>
        <span class="c1"># not already present</span>
        <span class="k">for</span> <span class="n">uuid</span><span class="p">,</span> <span class="n">ticket</span> <span class="ow">in</span> <span class="n">tiny_index</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">split</span> <span class="o">=</span> <span class="n">uuid</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
            <span class="n">row_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">split</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">jira_cell</span> <span class="o">=</span> <span class="n">get_jira_cell</span><span class="p">(</span><span class="n">row_id</span><span class="p">,</span> <span class="n">sheet</span><span class="p">,</span> <span class="n">sheet_col_map</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">jira_cell</span><span class="p">:</span>
                <span class="c1"># Jira column and cell data should exist on this sheet but</span>
                <span class="c1"># don&#39;t for some reason?</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Jira Cell not found on Sheet Name </span><span class="si">{}</span><span class="s2"> | &quot;</span>
                          <span class="s2">&quot;Sheet ID </span><span class="si">{}</span><span class="s2"> | Row ID </span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sheet</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                                                            <span class="n">sheet</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">row_id</span><span class="p">)</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">jira_cell</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">ticket</span><span class="p">:</span>
                <span class="c1"># Jira Ticket has already been copied to the sheet</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">jira_cell</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">jira_cell</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;None&quot;</span><span class="p">:</span>
                <span class="c1"># Jira Ticket cell isn&#39;t &quot;Pending...&quot; so it&#39;s not ready for</span>
                <span class="c1"># a new Jira Ticket. Skip.</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">jira_cell</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;Pending...&quot;</span><span class="p">:</span>
                <span class="c1"># Jira Ticket column for this row is &quot;Pending...&quot;, copy back</span>
                <span class="c1"># the ticket from the Index sheet into the row.</span>
                <span class="n">new_row</span> <span class="o">=</span> <span class="n">smartsheet</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Row</span><span class="p">()</span>
                <span class="n">new_row</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">row_id</span>
                <span class="n">new_row</span><span class="o">.</span><span class="n">cells</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s1">&#39;column_id&#39;</span><span class="p">:</span> <span class="n">sheet_col_map</span><span class="p">[</span><span class="n">app_vars</span><span class="o">.</span><span class="n">jira_col</span><span class="p">],</span>
                    <span class="s1">&#39;object_value&#39;</span><span class="p">:</span> <span class="n">ticket</span>
                <span class="p">})</span>
                <span class="n">rows_to_update</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_row</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">rows_to_update</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Updating Sheet Name: </span><span class="si">{}</span><span class="s2"> | Sheet ID </span><span class="si">{}</span><span class="s2"> with </span><span class="si">{}</span><span class="s2"> rows of &quot;</span>
                      <span class="s2">&quot;newly created Jira Tickets.&quot;</span>
                      <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sheet</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">sheet</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows_to_update</span><span class="p">))</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="n">smartsheet_api</span><span class="o">.</span><span class="n">write_rows_to_sheet</span><span class="p">(</span><span class="n">rows_to_update</span><span class="p">,</span> <span class="n">sheet</span><span class="p">,</span>
                                               <span class="n">write_method</span><span class="o">=</span><span class="s2">&quot;update&quot;</span><span class="p">)</span>
            <span class="n">sheets_updated</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;No new Jira Tickets are ready for copy to &quot;</span>
                      <span class="s2">&quot;Sheet Name: </span><span class="si">{}</span><span class="s2"> | Sheet ID: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sheet</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                                                              <span class="n">sheet</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sheets_updated</span>
</pre></div>

        </details>

            <div class="docstring"><p>Uses the UUID column to identify the row that originally pushed data
   into Jira. Copies the Jira Ticket back into the Program Plan</p>

<h6 id="args">Args</h6>

<ul>
<li><strong>source_sheets (list):</strong>  A list of Smartsheet Sheet objects push the
Jira Tickets into</li>
<li><strong>index_sheet (smartsheet.models.Sheet):</strong>  The Jira Index Sheet that
contains the UUID of the originating row and the Jira Ticket
that we want to copy to the source sheet.</li>
<li><strong>index_col_map (dict):</strong>  The column map of Column Names: Column IDs
for the Jira Index Sheet</li>
</ul>

<h6 id="raises">Raises</h6>

<ul>
<li><strong>TypeError:</strong>  Sheet must be a list of sheets</li>
<li><strong>TypeError:</strong>  Index Sheet must be a dict or smartsheet.Sheet object</li>
<li><strong>TypeError:</strong>  Index Column Map must be a dict</li>
</ul>
</div>


                </section>
                <section id="copy_errors_to_sheet">
                            <div class="attr function"><a class="headerlink" href="#copy_errors_to_sheet">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">copy_errors_to_sheet</span><span class="signature">()</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">copy_errors_to_sheet</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Copies any sync errors back to the original sheet so that the end user</span>
<span class="sd">       knows if/when/why a ticket creation failed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">push_sheet</span><span class="p">,</span> <span class="n">push_col_map</span> <span class="o">=</span> <span class="n">get_push_tickets_sheet</span><span class="p">()</span>
    <span class="n">success_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">failure_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">skip_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">push_sheet</span><span class="o">.</span><span class="n">rows</span><span class="p">:</span>
        <span class="n">uuid_cell</span> <span class="o">=</span> <span class="n">helper</span><span class="o">.</span><span class="n">get_cell_data</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">app_vars</span><span class="o">.</span><span class="n">uuid_col</span><span class="p">,</span> <span class="n">push_col_map</span><span class="p">)</span>
        <span class="n">sync_cell</span> <span class="o">=</span> <span class="n">helper</span><span class="o">.</span><span class="n">get_cell_data</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="s2">&quot;Sync Status&quot;</span><span class="p">,</span> <span class="n">push_col_map</span><span class="p">)</span>

        <span class="c1"># Skip empty UUID or Sync Error cells or None cell values.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">uuid_cell</span><span class="p">:</span>
            <span class="n">skip_count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">sync_cell</span><span class="p">:</span>
            <span class="n">skip_count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">uuid_cell</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="n">skip_count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">sync_cell</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="n">skip_count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">continue</span>

        <span class="c1"># Get the sheet ID and row ID from the UUID</span>
        <span class="n">split</span> <span class="o">=</span> <span class="n">uuid_cell</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
        <span class="n">sheet_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">split</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">row_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">split</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="c1"># Get the Jira Cell value in the sheet and validate that it should</span>
        <span class="c1"># be written to.</span>
        <span class="n">sheet</span> <span class="o">=</span> <span class="n">smartsheet_api</span><span class="o">.</span><span class="n">get_sheet</span><span class="p">(</span><span class="n">sheet_id</span><span class="p">,</span> <span class="n">config</span><span class="o">.</span><span class="n">minutes</span><span class="p">)</span>
        <span class="n">col_map</span> <span class="o">=</span> <span class="n">helper</span><span class="o">.</span><span class="n">get_column_map</span><span class="p">(</span><span class="n">sheet</span><span class="p">)</span>
        <span class="n">dest_row</span> <span class="o">=</span> <span class="n">smartsheet_api</span><span class="o">.</span><span class="n">get_row</span><span class="p">(</span><span class="n">sheet</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">row_id</span><span class="p">)</span>
        <span class="n">jira_cell</span> <span class="o">=</span> <span class="n">helper</span><span class="o">.</span><span class="n">get_cell_data</span><span class="p">(</span><span class="n">dest_row</span><span class="p">,</span> <span class="n">app_vars</span><span class="o">.</span><span class="n">jira_col</span><span class="p">,</span> <span class="n">col_map</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[a-zA-Z]+-\d+&quot;</span><span class="p">,</span> <span class="n">jira_cell</span><span class="o">.</span><span class="n">value</span><span class="p">)):</span>
            <span class="c1"># Cell value matches the Jira Ticket pattern, skip.</span>
            <span class="n">skip_count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="s2">&quot;reasonPhrase&quot;</span> <span class="ow">in</span> <span class="n">jira_cell</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="c1"># Sync Cell has already been copied.</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;reasonPhrase in Jira Cell, skipping.&quot;</span><span class="p">)</span>
            <span class="n">skip_count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">continue</span>

        <span class="c1"># Write the sync error cell to the row</span>
        <span class="n">new_row</span> <span class="o">=</span> <span class="n">smartsheet</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Row</span><span class="p">()</span>
        <span class="n">new_row</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">row_id</span>
        <span class="n">sync_cell</span><span class="o">.</span><span class="n">column_id</span> <span class="o">=</span> <span class="n">col_map</span><span class="p">[</span><span class="n">app_vars</span><span class="o">.</span><span class="n">jira_col</span><span class="p">]</span>
        <span class="n">sync_cell</span><span class="o">.</span><span class="n">hyperlink</span> <span class="o">=</span> <span class="n">smartsheet</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">ExplicitNull</span><span class="p">()</span>
        <span class="n">new_row</span><span class="o">.</span><span class="n">cells</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sync_cell</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">smartsheet_api</span><span class="o">.</span><span class="n">write_rows_to_sheet</span><span class="p">([</span><span class="n">new_row</span><span class="p">],</span> <span class="n">sheet</span><span class="p">,</span> <span class="s2">&quot;update&quot;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="o">.</span><span class="n">message</span> <span class="o">==</span> <span class="s2">&quot;SUCCESS&quot;</span><span class="p">:</span>
            <span class="n">failure_count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">success_count</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">success_count</span><span class="p">,</span> <span class="n">failure_count</span><span class="p">,</span> <span class="n">skip_count</span>
</pre></div>

        </details>

            <div class="docstring"><p>Copies any sync errors back to the original sheet so that the end user
knows if/when/why a ticket creation failed.</p>
</div>


                </section>
                <section id="copy_uuid_to_index_sheet">
                            <div class="attr function"><a class="headerlink" href="#copy_uuid_to_index_sheet">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">copy_uuid_to_index_sheet</span><span class="signature">(index_sheet, index_col_map)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">copy_uuid_to_index_sheet</span><span class="p">(</span><span class="n">index_sheet</span><span class="p">,</span> <span class="n">index_col_map</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Copy the UUID from the Push Data Sheet into the Jira Index Sheet after</span>
<span class="sd">       the ticket is created in Jira and synced in to the Index Sheet so that</span>
<span class="sd">       we can push the Jira Ticket back into the Program Plan that triggered</span>
<span class="sd">       the ticket creation.</span>

<span class="sd">    Args:</span>
<span class="sd">        index_sheet (smartsheet.models.Sheet): The Jira Index Sheet</span>
<span class="sd">        index_col_map (dict): The map of Column Names to Column IDs</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if UUIDs were copied, False if they were not.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index_sheet</span><span class="p">,</span> <span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="n">smartsheet</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Sheet</span><span class="p">)):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Index Sheet should be dict or smartsheet.Sheet, not </span><span class="si">{}</span><span class="s2">&quot;</span>
                  <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">index_sheet</span><span class="p">))</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index_col_map</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Index Column Map should be dict, not </span><span class="si">{}</span><span class="s2">&quot;</span>
                  <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">index_col_map</span><span class="p">))</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">index_col_map</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Index Column Map must not be empty.&quot;</span>
                  <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">()</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="n">rows_to_write</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">push_ticket_sheet</span><span class="p">,</span> <span class="n">push_tickets_col_map</span> <span class="o">=</span> <span class="n">get_push_tickets_sheet</span><span class="p">()</span>
    <span class="c1"># Build an index of all rows on the Push Ticket Sheet that have UUIDs</span>
    <span class="c1"># AND Jira tickets</span>
    <span class="n">sub_index</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">build_sub_indexes</span><span class="p">(</span>
        <span class="n">push_ticket_sheet</span><span class="p">,</span> <span class="n">push_tickets_col_map</span><span class="p">)</span>

    <span class="c1"># For each row in the index sheet, get the cell data for the Jira Ticket</span>
    <span class="c1"># cell and the UUID cell.</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">index_sheet</span><span class="o">.</span><span class="n">rows</span><span class="p">:</span>
        <span class="n">jira_ticket</span> <span class="o">=</span> <span class="n">helper</span><span class="o">.</span><span class="n">get_cell_data</span><span class="p">(</span>
            <span class="n">row</span><span class="p">,</span> <span class="n">app_vars</span><span class="o">.</span><span class="n">jira_col</span><span class="p">,</span> <span class="n">index_col_map</span><span class="p">)</span>
        <span class="n">uuid_value</span> <span class="o">=</span> <span class="n">helper</span><span class="o">.</span><span class="n">get_cell_data</span><span class="p">(</span>
            <span class="n">row</span><span class="p">,</span> <span class="n">app_vars</span><span class="o">.</span><span class="n">uuid_col</span><span class="p">,</span> <span class="n">index_col_map</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">uuid_value</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="c1"># Skip rows with UUIDs.</span>
            <span class="k">continue</span>
        <span class="k">for</span> <span class="n">uuid</span><span class="p">,</span> <span class="n">sub_ticket</span> <span class="ow">in</span> <span class="n">sub_index</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">sub_ticket</span> <span class="o">==</span> <span class="n">jira_ticket</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Push ticket </span><span class="si">{}</span><span class="s2"> matches Index ticket </span><span class="si">{}</span><span class="s2">, writing &quot;</span>
                          <span class="s2">&quot;UUID: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sub_ticket</span><span class="p">,</span> <span class="n">jira_ticket</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                                             <span class="n">uuid</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="n">new_row</span> <span class="o">=</span> <span class="n">smartsheet</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Row</span><span class="p">()</span>
                <span class="n">new_row</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">id</span>
                <span class="n">new_row</span><span class="o">.</span><span class="n">cells</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s1">&#39;column_id&#39;</span><span class="p">:</span> <span class="n">index_col_map</span><span class="p">[</span><span class="n">app_vars</span><span class="o">.</span><span class="n">uuid_col</span><span class="p">],</span>
                    <span class="s1">&#39;object_value&#39;</span><span class="p">:</span> <span class="n">uuid</span>
                <span class="p">})</span>
                <span class="n">rows_to_write</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_row</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">rows_to_write</span><span class="p">:</span>
        <span class="n">smartsheet_api</span><span class="o">.</span><span class="n">write_rows_to_sheet</span><span class="p">(</span><span class="n">rows_to_write</span><span class="p">,</span> <span class="n">index_sheet</span><span class="p">,</span>
                                           <span class="n">write_method</span><span class="o">=</span><span class="s2">&quot;update&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;No UUIDs copied to Sheet ID: </span><span class="si">{}</span><span class="s2">, Sheet Name: </span><span class="si">{}</span><span class="s2">&quot;</span>
                  <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index_sheet</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">index_sheet</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>
</pre></div>

        </details>

            <div class="docstring"><p>Copy the UUID from the Push Data Sheet into the Jira Index Sheet after
   the ticket is created in Jira and synced in to the Index Sheet so that
   we can push the Jira Ticket back into the Program Plan that triggered
   the ticket creation.</p>

<h6 id="args">Args</h6>

<ul>
<li><strong>index_sheet (smartsheet.models.Sheet):</strong>  The Jira Index Sheet</li>
<li><strong>index_col_map (dict):</strong>  The map of Column Names to Column IDs</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>bool: True if UUIDs were copied, False if they were not.</p>
</blockquote>
</div>


                </section>
                <section id="build_row_data">
                            <div class="attr function"><a class="headerlink" href="#build_row_data">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">build_row_data</span><span class="signature">(row, col_map)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">build_row_data</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">col_map</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Builds the row data necessary to create new tickets in Jira. Manually</span>
<span class="sd">       parses a row from a Program Plan and copies select data into the Push</span>
<span class="sd">       Jira Ticket Sheet</span>

<span class="sd">    Args:</span>
<span class="sd">        row (smartsheet.models.Row): The row to parse</span>
<span class="sd">        col_map (dict): The column map of Column Name: Column ID</span>

<span class="sd">    Raises:</span>
<span class="sd">        TypeError: Row must be a dict or smartsheet.models.Row</span>
<span class="sd">        TypeError: Column map must be a dict</span>
<span class="sd">        ValueError: Row must not be empty</span>
<span class="sd">        ValueError: Column map must not be empty</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: A dictionary of the subest of row data to upload to Smartsheet</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="n">smartsheet</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Row</span><span class="p">)):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Sheet should be dict or smartsheet.Sheet, not </span><span class="si">{}</span><span class="s2">&quot;</span>
                  <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">row</span><span class="p">))</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">col_map</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Sheet Column Map should be dict, not </span><span class="si">{}</span><span class="s2">&quot;</span>
                  <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">col_map</span><span class="p">))</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">row</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Row must not be empty.&quot;</span>
                  <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">()</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">col_map</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Column Map must not be empty.&quot;</span>
                  <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">()</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="n">row_data</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">project_columns</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cell</span> <span class="o">=</span> <span class="n">helper</span><span class="o">.</span><span class="n">get_cell_data</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">col_map</span><span class="p">)</span>
            <span class="n">row_data</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">cell</span><span class="o">.</span><span class="n">value</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">continue</span>
    <span class="n">row_data</span><span class="p">[</span><span class="s2">&quot;row_num&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">row_number</span>
    <span class="k">return</span> <span class="n">row_data</span>
</pre></div>

        </details>

            <div class="docstring"><p>Builds the row data necessary to create new tickets in Jira. Manually
   parses a row from a Program Plan and copies select data into the Push
   Jira Ticket Sheet</p>

<h6 id="args">Args</h6>

<ul>
<li><strong>row (smartsheet.models.Row):</strong>  The row to parse</li>
<li><strong>col_map (dict):</strong>  The column map of Column Name: Column ID</li>
</ul>

<h6 id="raises">Raises</h6>

<ul>
<li><strong>TypeError:</strong>  Row must be a dict or smartsheet.models.Row</li>
<li><strong>TypeError:</strong>  Column map must be a dict</li>
<li><strong>ValueError:</strong>  Row must not be empty</li>
<li><strong>ValueError:</strong>  Column map must not be empty</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>dict: A dictionary of the subest of row data to upload to Smartsheet</p>
</blockquote>
</div>


                </section>
                <section id="create_ticket_index">
                            <div class="attr function"><a class="headerlink" href="#create_ticket_index">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">create_ticket_index</span><span class="signature">(source_sheets, index_sheet, index_col_map)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">create_ticket_index</span><span class="p">(</span><span class="n">source_sheets</span><span class="p">,</span> <span class="n">index_sheet</span><span class="p">,</span> <span class="n">index_col_map</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Loads in all sheets recently modified and creates an index of any rows</span>
<span class="sd">       that are ready to create a Jira Ticket or are pending an existing Jira</span>
<span class="sd">       Ticket creation.</span>

<span class="sd">    Args:</span>
<span class="sd">        source_sheets (list): A list of all Smartsheet Sheet objects</span>
<span class="sd">        index_sheet (smartsheet.Sheet): The Jira Index Sheet</span>
<span class="sd">        index_col_map (dict): The Jira Index Sheet column map in the form of</span>
<span class="sd">                              Column Name: Column ID</span>

<span class="sd">    Raises:</span>
<span class="sd">        TypeError: Source Sheets must be a list of sheets</span>
<span class="sd">        TypeError: Index Sheet must be a dict or Smartsheet Sheet object</span>
<span class="sd">        TypeError: Index Column Map must be a dict</span>
<span class="sd">        ValueError: Column map must not be empty</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: A dictionary of all tickets that should be created across all</span>
<span class="sd">              Program Plans</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source_sheets</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Sheet should be dict or smartsheet.Sheet, not </span><span class="si">{}</span><span class="s2">&quot;</span>
                  <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">source_sheets</span><span class="p">))</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index_sheet</span><span class="p">,</span> <span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="n">smartsheet</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Sheet</span><span class="p">)):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Index Sheet should be dict or smartsheet.Sheet, not </span><span class="si">{}</span><span class="s2">&quot;</span>
                  <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">index_sheet</span><span class="p">))</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index_col_map</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Index Column Map should be dict, not </span><span class="si">{}</span><span class="s2">&quot;</span>
                  <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">index_col_map</span><span class="p">))</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">index_col_map</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Column Map must not be empty.&quot;</span>
                  <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">()</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="n">tickets_to_create</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">pending_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">parent_pending_count</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">sheet</span> <span class="ow">in</span> <span class="n">source_sheets</span><span class="p">:</span>
        <span class="n">col_map</span> <span class="o">=</span> <span class="n">helper</span><span class="o">.</span><span class="n">get_column_map</span><span class="p">(</span><span class="n">sheet</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Loaded </span><span class="si">{}</span><span class="s2"> rows from Sheet ID: </span><span class="si">{}</span><span class="s2"> | Sheet Name: </span><span class="si">{}</span><span class="s2">&quot;</span>
                  <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sheet</span><span class="o">.</span><span class="n">rows</span><span class="p">),</span> <span class="n">sheet</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">sheet</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">app_vars</span><span class="o">.</span><span class="n">uuid_col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">col_map</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Sheet ID </span><span class="si">{}</span><span class="s2"> | Sheet Name </span><span class="si">{}</span><span class="s2"> doesn&#39;t have UUID column. &quot;</span>
                      <span class="s2">&quot;Skipping sheet.&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sheet</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">sheet</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="n">sheet_rows_to_update</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">sheet</span><span class="o">.</span><span class="n">rows</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;------------------------&quot;</span><span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;New Row&quot;</span><span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;------------------------&quot;</span><span class="p">)</span>
            <span class="n">row_data</span> <span class="o">=</span> <span class="n">build_row_data</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">col_map</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">row_data</span><span class="p">[</span><span class="n">app_vars</span><span class="o">.</span><span class="n">jira_col</span><span class="p">]:</span>
                <span class="c1"># Skip rows with no data in the Jira column</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Row </span><span class="si">{}</span><span class="s2"> skipped because Jira column was empty.&quot;</span>
                          <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">row_data</span><span class="p">[</span><span class="s2">&quot;row_num&quot;</span><span class="p">])</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">row_data</span><span class="p">[</span><span class="n">app_vars</span><span class="o">.</span><span class="n">summary_col</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;True&quot;</span><span class="p">:</span>
                <span class="c1"># Skip summary rows</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Row </span><span class="si">{}</span><span class="s2"> skipped because Summary column was true.&quot;</span>
                          <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">row_data</span><span class="p">[</span><span class="s2">&quot;row_num&quot;</span><span class="p">])</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">row_data</span><span class="p">[</span><span class="s2">&quot;Team&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># Need team defined (so we can get project key). Skip.</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Row </span><span class="si">{}</span><span class="s2"> skipped because Team column was empty.&quot;</span>
                          <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">row_data</span><span class="p">[</span><span class="s2">&quot;row_num&quot;</span><span class="p">])</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">row_data</span><span class="p">[</span><span class="n">app_vars</span><span class="o">.</span><span class="n">uuid_col</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># No UUID means we can&#39;t push the created ticket IDs back</span>
                <span class="c1"># into the program sheets. Skip.</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Row </span><span class="si">{}</span><span class="s2"> skipped because UUID column was empty.&quot;</span>
                          <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">row_data</span><span class="p">[</span><span class="s2">&quot;row_num&quot;</span><span class="p">])</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">row_data</span><span class="p">[</span><span class="s1">&#39;Issue Type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Sub-Task&quot;</span><span class="p">:</span>
                <span class="c1"># Skip Subtasks, we can&#39;t create them with the connector</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Row </span><span class="si">{}</span><span class="s2"> skipped because Parent Issue Type is </span><span class="si">{}</span><span class="s2">.&quot;</span>
                          <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">row_data</span><span class="p">[</span><span class="s2">&quot;row_num&quot;</span><span class="p">],</span>
                                     <span class="n">row_data</span><span class="p">[</span><span class="s2">&quot;Parent Issue Type&quot;</span><span class="p">])</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">row_data</span><span class="p">[</span><span class="s1">&#39;Parent Issue Type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Sub-Task&quot;</span><span class="p">:</span>
                <span class="c1"># Skip Subtasks, we can&#39;t create them with the connector</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Row </span><span class="si">{}</span><span class="s2"> skipped because Parent Issue Type is </span><span class="si">{}</span><span class="s2">.&quot;</span>
                          <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">row_data</span><span class="p">[</span><span class="s2">&quot;row_num&quot;</span><span class="p">],</span>
                                     <span class="n">row_data</span><span class="p">[</span><span class="s2">&quot;Parent Issue Type&quot;</span><span class="p">])</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[a-zA-Z]+-\d+&quot;</span><span class="p">,</span>
                             <span class="nb">str</span><span class="p">(</span><span class="n">row_data</span><span class="p">[</span><span class="n">app_vars</span><span class="o">.</span><span class="n">jira_col</span><span class="p">]))):</span>
                <span class="c1"># Skip tickets that match the Jira Ticket pattern</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Jira Ticket </span><span class="si">{}</span><span class="s2"> on row </span><span class="si">{}</span><span class="s2"> matches the Jira Ticket&quot;</span>
                          <span class="s2">&quot;pattern&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">row_data</span><span class="p">[</span><span class="n">app_vars</span><span class="o">.</span><span class="n">jira_col</span><span class="p">],</span>
                                            <span class="n">row_data</span><span class="p">[</span><span class="s2">&quot;row_num&quot;</span><span class="p">])</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="s2">&quot;reasonPhrase&quot;</span> <span class="ow">in</span> <span class="n">row_data</span><span class="p">[</span><span class="s2">&quot;Parent Ticket&quot;</span><span class="p">]:</span>
                <span class="c1"># Skip rows where the parent ticket has a sync error</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Parent ticket for row </span><span class="si">{}</span><span class="s2"> has a Jira Sync error: &quot;</span>
                          <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">. Skipping.&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">row_data</span><span class="p">[</span><span class="s2">&quot;row_num&quot;</span><span class="p">],</span>
                                                  <span class="n">row_data</span><span class="p">[</span><span class="n">app_vars</span><span class="o">.</span><span class="n">jira_col</span><span class="p">])</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="s2">&quot;reasonPhrase&quot;</span> <span class="ow">in</span> <span class="n">row_data</span><span class="p">[</span><span class="n">app_vars</span><span class="o">.</span><span class="n">jira_col</span><span class="p">]:</span>
                <span class="c1"># Skip rows where the Jira ticket has a sync error</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Jira ticket for row </span><span class="si">{}</span><span class="s2"> is a Jira Sync error: &quot;</span>
                          <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">. Skipping.&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">row_data</span><span class="p">[</span><span class="s2">&quot;row_num&quot;</span><span class="p">],</span>
                                                  <span class="n">row_data</span><span class="p">[</span><span class="n">app_vars</span><span class="o">.</span><span class="n">jira_col</span><span class="p">])</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">row_data</span><span class="p">[</span><span class="s2">&quot;Parent Ticket&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> \
                    <span class="n">row_data</span><span class="p">[</span><span class="n">app_vars</span><span class="o">.</span><span class="n">jira_col</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;Create&quot;</span><span class="p">,</span> <span class="s2">&quot;create&quot;</span><span class="p">):</span>
                <span class="n">tickets_to_create</span><span class="p">[</span><span class="n">row_data</span><span class="p">[</span><span class="n">app_vars</span><span class="o">.</span><span class="n">uuid_col</span><span class="p">]]</span> <span class="o">=</span> <span class="n">row_data</span>
                <span class="c1"># Set these rows to &quot;Pending...&quot;</span>
                <span class="n">new_row</span> <span class="o">=</span> <span class="n">smartsheet</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Row</span><span class="p">()</span>
                <span class="n">new_row</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">id</span>
                <span class="n">new_row</span><span class="o">.</span><span class="n">cells</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s1">&#39;column_id&#39;</span><span class="p">:</span> <span class="n">col_map</span><span class="p">[</span><span class="n">app_vars</span><span class="o">.</span><span class="n">jira_col</span><span class="p">],</span>
                    <span class="s1">&#39;object_value&#39;</span><span class="p">:</span> <span class="s2">&quot;Pending...&quot;</span>
                <span class="p">})</span>
                <span class="n">sheet_rows_to_update</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_row</span><span class="p">)</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Appended row UUID: </span><span class="si">{}</span><span class="s2"> and associated data to the &quot;</span>
                          <span class="s2">&quot;list of rows to update and set the Jira Ticket &quot;</span>
                          <span class="s2">&quot;column in Sheet Name: </span><span class="si">{}</span><span class="s2"> to Pending...&quot;</span>
                          <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">row_data</span><span class="p">[</span><span class="n">app_vars</span><span class="o">.</span><span class="n">uuid_col</span><span class="p">],</span> <span class="n">sheet</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="c1"># logging.debug(row_data)</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">row_data</span><span class="p">[</span><span class="n">app_vars</span><span class="o">.</span><span class="n">jira_col</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Pending...&quot;</span><span class="p">:</span>
                <span class="c1"># Skip any row that&#39;s already in process</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Skipped because Jira Ticket or Parent Ticket &quot;</span>
                          <span class="s2">&quot;column was set to Pending...&quot;</span><span class="p">)</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="c1"># logging.debug(row_data)</span>
                <span class="n">pending_count</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">row_data</span><span class="p">[</span><span class="s1">&#39;Parent Ticket&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Pending...&quot;</span><span class="p">:</span>
                <span class="c1"># Skip any row that&#39;s already in process</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Skipped because Parent Ticket column was set to &quot;</span>
                          <span class="s2">&quot;Pending...&quot;</span><span class="p">)</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="c1"># logging.debug(row_data)</span>
                <span class="n">parent_pending_count</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">row_data</span><span class="p">[</span><span class="s1">&#39;Parent Ticket&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;Create&#39;</span><span class="p">,</span> <span class="s1">&#39;create&#39;</span><span class="p">,</span>
                                                 <span class="s1">&#39;Pending...&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[a-zA-Z]+-\d+&quot;</span><span class="p">,</span>
                                     <span class="n">row_data</span><span class="p">[</span><span class="s2">&quot;Parent Ticket&quot;</span><span class="p">])):</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Parent Ticket </span><span class="si">{}</span><span class="s2"> on row </span><span class="si">{}</span><span class="s2"> does not match the &quot;</span>
                              <span class="s2">&quot;Jira Ticket pattern. Skipping&quot;</span>
                              <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">row_data</span><span class="p">[</span><span class="n">app_vars</span><span class="o">.</span><span class="n">jira_col</span><span class="p">],</span>
                                         <span class="n">row_data</span><span class="p">[</span><span class="s2">&quot;row_num&quot;</span><span class="p">])</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                    <span class="k">continue</span>

                <span class="k">if</span> <span class="n">row_data</span><span class="p">[</span><span class="n">app_vars</span><span class="o">.</span><span class="n">jira_col</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;Create&#39;</span><span class="p">,</span> <span class="s1">&#39;create&#39;</span><span class="p">):</span>
                    <span class="c1"># Add row data to create tickets.</span>
                    <span class="n">tickets_to_create</span><span class="p">[</span><span class="n">row_data</span><span class="p">[</span><span class="n">app_vars</span><span class="o">.</span><span class="n">uuid_col</span><span class="p">]]</span> <span class="o">=</span> <span class="n">row_data</span>

                    <span class="c1"># Set these rows to &quot;Pending...&quot; in the Plan sheet.</span>
                    <span class="n">new_row</span> <span class="o">=</span> <span class="n">smartsheet</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Row</span><span class="p">()</span>
                    <span class="n">new_row</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">id</span>
                    <span class="n">new_row</span><span class="o">.</span><span class="n">cells</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                        <span class="s1">&#39;column_id&#39;</span><span class="p">:</span> <span class="n">col_map</span><span class="p">[</span><span class="n">app_vars</span><span class="o">.</span><span class="n">jira_col</span><span class="p">],</span>
                        <span class="s1">&#39;object_value&#39;</span><span class="p">:</span> <span class="s2">&quot;Pending...&quot;</span>
                    <span class="p">})</span>
                    <span class="n">sheet_rows_to_update</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_row</span><span class="p">)</span>
                    <span class="n">pending_count</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">continue</span>
            <span class="c1"># TODO: Validate Jira ticket so that comments don&#39;t</span>
            <span class="c1"># cause errors.</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Parent Ticket isn&#39;t &#39;Create&#39; or &#39;Pending...&#39; &quot;</span>
                      <span class="s2">&quot;but it does have a value. Dumping data.&quot;</span><span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">row_data</span><span class="p">)</span>

        <span class="c1"># Validate that there are rows to write.</span>
        <span class="k">if</span> <span class="n">sheet_rows_to_update</span><span class="p">:</span>
            <span class="n">smartsheet_api</span><span class="o">.</span><span class="n">write_rows_to_sheet</span><span class="p">(</span><span class="n">sheet_rows_to_update</span><span class="p">,</span> <span class="n">sheet</span><span class="p">,</span>
                                               <span class="n">write_method</span><span class="o">=</span><span class="s2">&quot;update&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;No rows to update for Sheet ID: </span><span class="si">{}</span><span class="s2">, Sheet Name: </span><span class="si">{}</span><span class="s2">&quot;</span>
                      <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sheet</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">sheet</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Sheet ID: </span><span class="si">{}</span><span class="s2"> | Sheet Name: </span><span class="si">{}</span><span class="s2"> has </span><span class="si">{}</span><span class="s2"> rows pending ticket &quot;</span>
                  <span class="s2">&quot;creation. </span><span class="si">{}</span><span class="s2"> rows are waiting on parent ticket &quot;</span>
                  <span class="s2">&quot;creation.&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sheet</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">sheet</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">pending_count</span><span class="p">,</span>
                                      <span class="n">parent_pending_count</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Top-level Rows to create first&quot;</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;------------------------&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">tickets_to_create</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">tickets_to_create</span>
</pre></div>

        </details>

            <div class="docstring"><p>Loads in all sheets recently modified and creates an index of any rows
   that are ready to create a Jira Ticket or are pending an existing Jira
   Ticket creation.</p>

<h6 id="args">Args</h6>

<ul>
<li><strong>source_sheets (list):</strong>  A list of all Smartsheet Sheet objects</li>
<li><strong>index_sheet (smartsheet.Sheet):</strong>  The Jira Index Sheet</li>
<li><strong>index_col_map (dict):</strong>  The Jira Index Sheet column map in the form of
Column Name: Column ID</li>
</ul>

<h6 id="raises">Raises</h6>

<ul>
<li><strong>TypeError:</strong>  Source Sheets must be a list of sheets</li>
<li><strong>TypeError:</strong>  Index Sheet must be a dict or Smartsheet Sheet object</li>
<li><strong>TypeError:</strong>  Index Column Map must be a dict</li>
<li><strong>ValueError:</strong>  Column map must not be empty</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>dict: A dictionary of all tickets that should be created across all
        Program Plans</p>
</blockquote>
</div>


                </section>
                <section id="modify_scheduler">
                            <div class="attr function"><a class="headerlink" href="#modify_scheduler">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">modify_scheduler</span><span class="signature">(time)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">modify_scheduler</span><span class="p">(</span><span class="n">time</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Dynamically modifies the given job depending on how long the last</span>
<span class="sd">       job took to complete.</span>

<span class="sd">    Args:</span>
<span class="sd">        time (int): The amount of time elapsed from the start of the job</span>
<span class="sd">                    to the end of the job (in seconds)</span>

<span class="sd">    Raises:</span>
<span class="sd">        TypeError: Time must be an int or float</span>
<span class="sd">        ValueError: Time must be a positive integer</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: A message about whether the interval was modified or remains</span>
<span class="sd">             the same</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Time must be an int or float, not </span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">time</span><span class="p">))</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">time</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Time must be a positive int or float, not </span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="n">time_in_seconds</span> <span class="o">=</span> <span class="n">time</span>
    <span class="c1"># If time comes in in minutes, make time = 60 seconds</span>
    <span class="k">if</span> <span class="n">time</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">time</span> <span class="o">*</span> <span class="mi">60</span>

    <span class="c1"># Get currently scheduled interval in minutes</span>
    <span class="n">jobs</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">scheduler</span><span class="o">.</span><span class="n">get_job</span><span class="p">(</span><span class="s2">&quot;create_jira_interval&quot;</span><span class="p">)</span>
    <span class="n">jobs</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">jobs</span><span class="p">)</span>
    <span class="n">split</span> <span class="o">=</span> <span class="n">jobs</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
    <span class="n">interval</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">split</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

    <span class="c1"># Round time up to the nearest minute</span>
    <span class="n">time</span> <span class="o">=</span> <span class="n">time</span> <span class="o">//</span> <span class="mi">60</span> <span class="o">+</span> <span class="p">(</span><span class="n">time</span> <span class="o">%</span> <span class="mi">60</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">interval</span> <span class="o">==</span> <span class="n">time</span><span class="p">:</span>
        <span class="c1"># Do nothing. Interval is correctly sized</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Job interval and job runtime are within 1 minute of &quot;</span>
                  <span class="s2">&quot;each other. No changes to interval.&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">interval</span> <span class="o">&gt;</span> <span class="n">time</span><span class="p">:</span>
        <span class="c1"># If the interval is greater than the time it took to run the process,</span>
        <span class="c1"># check to see how much more. If the total time the process took was</span>
        <span class="c1"># over 1 minute less than the interval, reduce the interval by 1</span>
        <span class="c1"># minute.</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="n">interval</span> <span class="o">-</span> <span class="n">time</span>
        <span class="k">if</span> <span class="n">delta</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">new_interval</span> <span class="o">=</span> <span class="n">interval</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">config</span><span class="o">.</span><span class="n">scheduler</span><span class="o">.</span><span class="n">reschedule_job</span><span class="p">(</span><span class="s2">&quot;create_jira_interval&quot;</span><span class="p">,</span>
                                            <span class="n">trigger</span><span class="o">=</span><span class="s2">&quot;interval&quot;</span><span class="p">,</span>
                                            <span class="n">minutes</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">new_interval</span><span class="p">))</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Job interval is </span><span class="si">{}</span><span class="s2"> minute(s) longer than the job &quot;</span>
                      <span class="s2">&quot;runtime. Reduced interval to </span><span class="si">{}</span><span class="s2"> minutes&quot;</span>
                      <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">delta</span><span class="p">),</span> <span class="n">new_interval</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;SUCCESS: Job interval </span><span class="si">{}</span><span class="s2">, elapsed time </span><span class="si">{}</span><span class="s2">, delta </span><span class="si">{}</span><span class="s2">&quot;</span>
                      <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">interval</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">delta</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">interval</span> <span class="o">&lt;</span> <span class="n">time</span><span class="p">:</span>
        <span class="c1"># If the interval is less than the time it took to run the process,</span>
        <span class="c1"># increase the interval. If the delta is less than one minute, add 1</span>
        <span class="c1"># minutes, otherwise add the delta to the interval</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">time_in_seconds</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
            <span class="n">elapsed_warning</span> <span class="o">=</span> <span class="n">helper</span><span class="o">.</span><span class="n">truncate</span><span class="p">(</span><span class="n">time_in_seconds</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">elapsed_warning</span> <span class="o">=</span> <span class="n">time_in_seconds</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Create Jira Tickets took </span><span class="si">{}</span><span class="s2"> seconds longer than &quot;</span>
                  <span class="s2">&quot;the interval&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">elapsed_warning</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="n">time</span> <span class="o">-</span> <span class="n">interval</span>
        <span class="k">if</span> <span class="n">delta</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">new_interval</span> <span class="o">=</span> <span class="n">interval</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">config</span><span class="o">.</span><span class="n">scheduler</span><span class="o">.</span><span class="n">reschedule_job</span><span class="p">(</span><span class="s2">&quot;create_jira_interval&quot;</span><span class="p">,</span>
                                            <span class="n">trigger</span><span class="o">=</span><span class="s2">&quot;interval&quot;</span><span class="p">,</span>
                                            <span class="n">minutes</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">new_interval</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_interval</span> <span class="o">=</span> <span class="n">interval</span> <span class="o">+</span> <span class="n">delta</span>
            <span class="n">config</span><span class="o">.</span><span class="n">scheduler</span><span class="o">.</span><span class="n">reschedule_job</span><span class="p">(</span><span class="s2">&quot;create_jira_interval&quot;</span><span class="p">,</span>
                                            <span class="n">trigger</span><span class="o">=</span><span class="s2">&quot;interval&quot;</span><span class="p">,</span>
                                            <span class="n">minutes</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">new_interval</span><span class="p">))</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;New job interval set to </span><span class="si">{}</span><span class="s2"> minutes&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="nb">int</span><span class="p">(</span><span class="n">new_interval</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;ERROR: Job interval </span><span class="si">{}</span><span class="s2">, elapsed time </span><span class="si">{}</span><span class="s2">&quot;</span>
                  <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">interval</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">msg</span>
</pre></div>

        </details>

            <div class="docstring"><p>Dynamically modifies the given job depending on how long the last
   job took to complete.</p>

<h6 id="args">Args</h6>

<ul>
<li><strong>time (int):</strong>  The amount of time elapsed from the start of the job
to the end of the job (in seconds)</li>
</ul>

<h6 id="raises">Raises</h6>

<ul>
<li><strong>TypeError:</strong>  Time must be an int or float</li>
<li><strong>ValueError:</strong>  Time must be a positive integer</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>str: A message about whether the interval was modified or remains
       the same</p>
</blockquote>
</div>


                </section>
                <section id="create_tickets">
                            <div class="attr function"><a class="headerlink" href="#create_tickets">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">create_tickets</span><span class="signature">(minutes=525600)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">create_tickets</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="n">app_vars</span><span class="o">.</span><span class="n">dev_minutes</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Main function passed to the scheduler to parse and upload data to</span>
<span class="sd">       Smartsheet so that new Jira Tickets can be created. Logs a warning</span>
<span class="sd">       if the process takes longer than the interval.</span>

<span class="sd">    Args:</span>
<span class="sd">        minutes (int, optional): Number of minutes in the past used to filter</span>
<span class="sd">                                 sheets and sheet data. Defaults to</span>
<span class="sd">                                 dev_minutes.</span>

<span class="sd">    Raises:</span>
<span class="sd">        TypeError: Minutes must be an int</span>
<span class="sd">        ValueError: Minutes must be a positive integer or 0</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">minutes</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Minutes should be type: int, not </span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">minutes</span><span class="p">))</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">minutes</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Minutes should be &gt;= 0, not </span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">minutes</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

    <span class="n">sheet_ids</span> <span class="o">=</span> <span class="n">get_data</span><span class="o">.</span><span class="n">get_all_sheet_ids</span><span class="p">(</span><span class="n">minutes</span><span class="p">,</span> <span class="n">config</span><span class="o">.</span><span class="n">workspace_id</span><span class="p">,</span>
                                           <span class="n">config</span><span class="o">.</span><span class="n">index_sheet</span><span class="p">)</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Sheet IDs object type </span><span class="si">{}</span><span class="s2">, object values </span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="nb">type</span><span class="p">(</span><span class="n">sheet_ids</span><span class="p">),</span> <span class="n">sheet_ids</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="n">source_sheets</span> <span class="o">=</span> <span class="n">get_data</span><span class="o">.</span><span class="n">refresh_source_sheets</span><span class="p">(</span><span class="n">sheet_ids</span><span class="p">,</span> <span class="n">minutes</span><span class="p">)</span>

    <span class="c1"># Load the index sheet and create a column map.</span>
    <span class="n">index_sheet</span> <span class="o">=</span> <span class="n">smartsheet_api</span><span class="o">.</span><span class="n">get_sheet</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">index_sheet</span><span class="p">,</span> <span class="n">minutes</span><span class="p">)</span>
    <span class="n">index_col_map</span> <span class="o">=</span> <span class="n">helper</span><span class="o">.</span><span class="n">get_column_map</span><span class="p">(</span><span class="n">index_sheet</span><span class="p">)</span>

    <span class="c1"># Copy UUIDs from Push sheet to Index Sheet</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting to copy UUIDs from the Push Sheet to the &quot;</span>
                 <span class="s2">&quot;Index Sheet.&quot;</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">copy_uuid_to_index_sheet</span><span class="p">(</span><span class="n">index_sheet</span><span class="p">,</span> <span class="n">index_col_map</span><span class="p">)</span>

    <span class="c1"># Refresh the index sheet since we just wrote data</span>
    <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
        <span class="n">index_sheet</span> <span class="o">=</span> <span class="n">smartsheet_api</span><span class="o">.</span><span class="n">get_sheet</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">index_sheet</span><span class="p">,</span>
                                               <span class="n">config</span><span class="o">.</span><span class="n">minutes</span><span class="p">)</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting to push sync error messages to the Program Plans.&quot;</span><span class="p">)</span>
    <span class="n">success_count</span><span class="p">,</span> <span class="n">failure_count</span><span class="p">,</span> <span class="n">skip_count</span> <span class="o">=</span> <span class="n">copy_errors_to_sheet</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">success_count</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Successfully pushed </span><span class="si">{}</span><span class="s2"> sync error messages to &quot;</span>
                  <span class="s2">&quot;their respective source sheets.&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">success_count</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">failure_count</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Failed to push </span><span class="si">{}</span><span class="s2"> sync error messages to &quot;</span>
                  <span class="s2">&quot;their respective source sheets.&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">failure_count</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">skip_count</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> rows skipped.&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">skip_count</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="c1"># Copy Jira Tickets from the index sheet back to the source sheets</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting to copy Jira Tickets from the Index Sheet to the &quot;</span>
                 <span class="s2">&quot;Program Plans.&quot;</span><span class="p">)</span>
    <span class="n">sheets_updated</span> <span class="o">=</span> <span class="n">copy_jira_tickets_to_sheets</span><span class="p">(</span>
        <span class="n">source_sheets</span><span class="p">,</span> <span class="n">index_sheet</span><span class="p">,</span> <span class="n">index_col_map</span><span class="p">)</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Updated </span><span class="si">{}</span><span class="s2"> Plan sheets with newly created Jira tickets.&quot;</span>
              <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sheets_updated</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="c1"># Create an index of rows pending ticket creation.</span>
    <span class="n">tickets_to_create</span> <span class="o">=</span> <span class="n">create_ticket_index</span><span class="p">(</span>
        <span class="n">source_sheets</span><span class="p">,</span> <span class="n">index_sheet</span><span class="p">,</span> <span class="n">index_col_map</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Parent Dict&quot;</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;------------------------&quot;</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">tickets_to_create</span><span class="p">)</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Parent Length: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tickets_to_create</span><span class="p">))</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="c1"># If there are rows that need tickets, write the rows to the Push Ticket</span>
    <span class="c1"># Sheet. Return true once the rows have been written.</span>
    <span class="k">if</span> <span class="n">tickets_to_create</span><span class="p">:</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">push_tickets_col_map</span> <span class="o">=</span> <span class="n">get_push_tickets_sheet</span><span class="p">()</span>
        <span class="n">rows_to_write</span> <span class="o">=</span> <span class="n">form_rows</span><span class="p">(</span><span class="n">tickets_to_create</span><span class="p">,</span> <span class="n">push_tickets_col_map</span><span class="p">)</span>
        <span class="n">smartsheet_api</span><span class="o">.</span><span class="n">write_rows_to_sheet</span><span class="p">(</span><span class="n">rows_to_write</span><span class="p">,</span>
                                           <span class="n">config</span><span class="o">.</span><span class="n">push_tickets_sheet</span><span class="p">)</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">elapsed</span> <span class="o">=</span> <span class="n">end</span> <span class="o">-</span> <span class="n">start</span>
        <span class="n">elapsed</span> <span class="o">=</span> <span class="n">helper</span><span class="o">.</span><span class="n">truncate</span><span class="p">(</span><span class="n">elapsed</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Create new tickets from Program Plan line items &quot;</span>
                     <span class="s2">&quot;took: </span><span class="si">{}</span><span class="s2"> seconds.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">elapsed</span><span class="p">))</span>
        <span class="n">interval_msg</span> <span class="o">=</span> <span class="n">modify_scheduler</span><span class="p">(</span><span class="n">elapsed</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">interval_msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="n">tickets_to_create</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;No parent or child rows remain to be written to the &quot;</span>
                  <span class="s2">&quot;Push Tickets Sheet.&quot;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">elapsed</span> <span class="o">=</span> <span class="n">end</span> <span class="o">-</span> <span class="n">start</span>
        <span class="n">elapsed</span> <span class="o">=</span> <span class="n">helper</span><span class="o">.</span><span class="n">truncate</span><span class="p">(</span><span class="n">elapsed</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Create new tickets from Program Plan line items &quot;</span>
                     <span class="s2">&quot;took: </span><span class="si">{}</span><span class="s2"> seconds.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">elapsed</span><span class="p">))</span>
        <span class="n">interval_msg</span> <span class="o">=</span> <span class="n">modify_scheduler</span><span class="p">(</span><span class="n">elapsed</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">interval_msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">elapsed</span> <span class="o">=</span> <span class="n">end</span> <span class="o">-</span> <span class="n">start</span>
        <span class="n">elapsed</span> <span class="o">=</span> <span class="n">helper</span><span class="o">.</span><span class="n">truncate</span><span class="p">(</span><span class="n">elapsed</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">interval_msg</span> <span class="o">=</span> <span class="n">modify_scheduler</span><span class="p">(</span><span class="n">elapsed</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">interval_msg</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Looping through rows rows to create Jira Tickts &quot;</span>
                  <span class="s2">&quot;failed with an unknown error.&quot;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
</pre></div>

        </details>

            <div class="docstring"><p>Main function passed to the scheduler to parse and upload data to
   Smartsheet so that new Jira Tickets can be created. Logs a warning
   if the process takes longer than the interval.</p>

<h6 id="args">Args</h6>

<ul>
<li><strong>minutes (int, optional):</strong>  Number of minutes in the past used to filter
sheets and sheet data. Defaults to
dev_minutes.</li>
</ul>

<h6 id="raises">Raises</h6>

<ul>
<li><strong>TypeError:</strong>  Minutes must be an int</li>
<li><strong>ValueError:</strong>  Minutes must be a positive integer or 0</li>
</ul>
</div>


                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.type) {
                    case "function":
                        heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span><span class="signature">(${doc.parameters.join(", ")})</span>`;
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.type}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>